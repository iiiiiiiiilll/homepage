<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python &mdash; luoxb&#39;s homepage 0.1 文档</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="prev" title="kaggle" href="kaggle.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> luoxb's homepage
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hello%20world.html">hello world</a></li>
<li class="toctree-l1"><a class="reference internal" href="cute.html">cute</a></li>
<li class="toctree-l1"><a class="reference internal" href="personal.html">about me</a></li>
<li class="toctree-l1"><a class="reference internal" href="project.html">project</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine%20learning.html">machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep%20learning.html">deep learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">python</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql.html">sql</a></li>
<li class="toctree-l1"><a class="reference internal" href="leetcode.html">leetcode</a></li>
<li class="toctree-l1"><a class="reference internal" href="kaggle.html">kaggle</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">当前文件路径</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">当前文件夹下面是否有指定文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pip">pip下载指定清华源</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">字典求最大值键值对</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key">字典最大值的key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datetime-timedelta">datetime / timedelta</a></li>
<li class="toctree-l2"><a class="reference internal" href="#itertools">itertools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">笛卡尔积</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">集合运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="#isinstance">isinstance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">查看对象所有方法与属性</a></li>
<li class="toctree-l2"><a class="reference internal" href="#is">is / ==</a></li>
<li class="toctree-l2"><a class="reference internal" href="#format">format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-list">list 按另一个list排序</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">速度解析</a></li>
<li class="toctree-l2"><a class="reference internal" href="#try-raise">try/raise</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pandas">pandas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#test-data">test_data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">打印显示列数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#csv">CSV读写</a></li>
<li class="toctree-l2"><a class="reference internal" href="#excel">Excel 读写</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">小数精度</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10">列转字典</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">值统计</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12">布尔值筛选</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list">列是否在list中</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id13">分位数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id14">按list取行</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15">相等比较</a></li>
<li class="toctree-l2"><a class="reference internal" href="#append-concat">append/ concat</a></li>
<li class="toctree-l2"><a class="reference internal" href="#apply">apply</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cut-qcut">cut/ qcut</a></li>
<li class="toctree-l2"><a class="reference internal" href="#drop-duplicates">drop_duplicates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#explode">explode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fillna">fillna()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#groupby">groupby</a></li>
<li class="toctree-l2"><a class="reference internal" href="#group-concat">group_concat</a></li>
<li class="toctree-l2"><a class="reference internal" href="#insert">insert</a></li>
<li class="toctree-l2"><a class="reference internal" href="#iterrows">iterrows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#itertuples">itertuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#join">join</a></li>
<li class="toctree-l2"><a class="reference internal" href="#map">map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nan">nan判断、统计</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pivot">pivot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pivot-table">pivot_table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot">plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rank">rank</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reindex">reindex</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reset-index">reset_index</a></li>
<li class="toctree-l2"><a class="reference internal" href="#replace">replace</a></li>
<li class="toctree-l2"><a class="reference internal" href="#series">Series值替换</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shuffle">shuffle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stack-unstack">stack/unstack</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sort">sort</a></li>
<li class="toctree-l2"><a class="reference internal" href="#to-numpy">to_numpy()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unique-nunique">unique/ nunique</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#numpy">Numpy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cumsum-cumprod">cumsum/cumprod</a></li>
<li class="toctree-l2"><a class="reference internal" href="#np-maximum">np.maximum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choice-sample">choice/ sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-indexing-and-slicing">Basic Indexing and Slicing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#np-arange">np.arange 生成日期</a></li>
<li class="toctree-l2"><a class="reference internal" href="#np-where">np.where</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#netwrokx">NetwrokX</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id16">测试数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17">可视化</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dir-nx-graph">dir(nx.Graph( ))</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create">create</a></li>
<li class="toctree-l2"><a class="reference internal" href="#attribute">attribute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#igraph">igraph</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-1">create</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-1">plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subgraph">subgraph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bfs">BFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#alter-attribute">alter attribute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#notebook">Notebook</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id20">插件安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id21">代码补全</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id22">字符串操作</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#ml">ML</a></li>
<li class="toctree-l1"><a class="reference internal" href="#linux">Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="#sql">SQL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#my-uid">my uid</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id23">服务器认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">Notebook连接</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hive-impala">hive/impala 差别</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-insert-data-is-forbidden-in-impala">why insert data is forbidden in impala</a></li>
<li class="toctree-l2"><a class="reference internal" href="#explain">explain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-table">create table</a></li>
<li class="toctree-l2"><a class="reference internal" href="#invalidate-metadata">INVALIDATE METADATA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id25">插入分区，删除分区，查看分区</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id26">查询结果建表</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-column">add column</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timestamp-to-date">timestamp, to_date</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id27">本月最后一天</a></li>
<li class="toctree-l2"><a class="reference internal" href="#last-value">last_value</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id28">连续时间窗口</a></li>
<li class="toctree-l2"><a class="reference internal" href="#greatest-least">greatest/ least</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id29">结果保留两位小数 / 小数转百分数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id30">类型转换, 模糊查询</a></li>
<li class="toctree-l2"><a class="reference internal" href="#substring">substring</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lpad-rpad">lpad/rpad</a></li>
<li class="toctree-l2"><a class="reference internal" href="#group-concat-1">group_concat</a></li>
<li class="toctree-l2"><a class="reference internal" href="#row-number">row_number( )</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id32">常用排名函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id33">速度解析</a></li>
<li class="toctree-l2"><a class="reference internal" href="#select-1-1">select 1+1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#infinity-nan">infinity/nan</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id35">分群重叠人数查看</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#algorithm">Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="#neo4j">Neo4j</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id36">Excel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vlookup">VLOOKUP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#alt-enter">单元格换行 Alt+Enter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#id37">用户名单推送</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sns-sns-dw-member-snapshot-d">sns.sns_dw_member_snapshot_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sns-dwd-sns-transmsg-d-view">sns.dwd_sns_transmsg_d_view</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id38">推送接收表</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-op-msg-receipt-d-v3">dwd.dwd_op_msg_receipt_d_v3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id39">单局表</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-game-rec-2ddz">dwd.dwd_game_rec_2ddz</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-usr-match-round-result">dwd.dwd_usr_match_round_result</a></li>
<li class="toctree-l2"><a class="reference internal" href="#event-dwd-usr-match-round-result">event.dwd_usr_match_round_result</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-bal-user-deal-d">dwd.dwd_bal_user_deal_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-bal-user-deal-vert-d">dwd.dwd_bal_user_deal_vert_d</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id40">日表</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dw-dw-bal-deal-balance-d">dw.dw_bal_deal_balance_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dw-dw-bal-user-match-stat-d">dw.dw_bal_user_match_stat_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dw-dw-bal-account-balance-d">dw.dw_bal_account_balance_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dw-dw-usr-retain-d">dw.dw_usr_retain_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-usr-workorder-d">dwd.dwd_usr_workorder_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dm-dm-losscallback-width-d">dm.dm_losscallback_width_d</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id41">商城</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-jjmall-order-info-new">dwd.dwd_jjmall_order_info_new</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-jjmall-sub-order-info-new">dwd.dwd_jjmall_sub_order_info_new</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-jjmall-order-comm-info-new">dwd.dwd_jjmall_order_comm_info_new</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-jjmall-order-comm-price-info-new">dwd.dwd_jjmall_order_comm_price_info_new</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-jjmall-order-payment-info">dwd.dwd_jjmall_order_payment_info</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id42">售后表</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id43">信息维度表</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dim-dim-product-info-d">dim.dim_product_info_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dim-dim-ware-info-v2">dim.dim_ware_info_v2 ( 物品维表)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dim-dim-currency-type">dim.dim_currency_type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dim-dim-company-area-code">dim.dim_company_area_code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dim-dim-company-prov-code">dim.dim_company_prov_code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id44">用户登录注册表</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-usr-register-d">dwd.dwd_usr_register_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-usr-online-v2-d">dwd.dwd_usr_online_v2_d</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dw-dw-usr-game-last-i">dw.dw_usr_game_last_i</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dwd-dwd-usr-login-d-nickname">dwd.dwd_usr_login_d ( nickname)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id45">标签表</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tags-tag-log-local-tostype-b">tags.tag_log_local_tostype_b [最常用终端]</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">luoxb's homepage</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/code.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="python">
<h1>Python<a class="headerlink" href="#python" title="永久链接至标题"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">注意文件名和要导入的模块名不能一样</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.5</span> <span class="kc">False</span>
<span class="mi">1</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="mf">1.5</span> <span class="kc">True</span>
</pre></div>
</div>
<section id="id1">
<h2>当前文件路径<a class="headerlink" href="#id1" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s1">&#39;__file__&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>


<span class="c1"># os.path.split(os.path.realpath(__file__))得到的是一个tuple</span>
<span class="c1"># 第一个位置是当前文件所在路径，第二个位置是当前文件名</span>
<span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">luoxb</span><span class="se">\\</span><span class="s1">PycharmProjects</span><span class="se">\\</span><span class="s1">spark&#39;</span><span class="p">,</span> <span class="s1">&#39;main.py&#39;</span><span class="p">)</span>

<span class="n">source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">luoxb</span><span class="se">\\</span><span class="s1">PycharmProjects</span><span class="se">\\</span><span class="s1">spark&#39;</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>当前文件夹下面是否有指定文件<a class="headerlink" href="#id2" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;community.csv&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;./&quot;</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pip">
<h2>pip下载指定清华源<a class="headerlink" href="#pip" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">lxml</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">tuna</span><span class="o">.</span><span class="n">tsinghua</span><span class="o">.</span><span class="n">edu</span><span class="o">.</span><span class="n">cn</span><span class="o">/</span><span class="n">simple</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>字典求最大值键值对<a class="headerlink" href="#id3" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">max</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="key">
<h2>字典最大值的key<a class="headerlink" href="#key" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">max_key</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">dic</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="datetime-timedelta">
<h2>datetime / timedelta<a class="headerlink" href="#datetime-timedelta" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="n">time</span><span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">time</span>  <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>
<span class="n">time</span><span class="p">,</span><span class="n">delta</span>

<span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2021-10-01&#39;</span><span class="p">)</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">-</span><span class="n">delta</span>

<span class="n">numpy</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2021-05-14&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="itertools">
<h2>itertools<a class="headerlink" href="#itertools" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">[(&#39;a&#39;, &#39;b&#39;), (&#39;a&#39;, &#39;c&#39;), (&#39;b&#39;, &#39;a&#39;), (&#39;b&#39;, &#39;c&#39;), (&#39;c&#39;, &#39;a&#39;), (&#39;c&#39;, &#39;b&#39;)]</span>


<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">[(&#39;a&#39;, &#39;b&#39;), (&#39;a&#39;, &#39;c&#39;), (&#39;b&#39;, &#39;c&#39;)]</span>


<span class="go">import itertools</span>
<span class="go">first_letter = lambda x: x[0]</span>
<span class="go">names = [&#39;Alan&#39;, &#39;Adam&#39;, &#39;Wes&#39;, &#39;Will&#39;, &#39;Albert&#39;, &#39;Steven&#39;]</span>

<span class="go">for letter, names in itertools.groupby(names, first_letter):</span>
<span class="go">    print(letter, list(names)) # names is a generator</span>

<span class="go">A [&#39;Alan&#39;, &#39;Adam&#39;]</span>
<span class="go">W [&#39;Wes&#39;, &#39;Will&#39;]</span>
<span class="go">A [&#39;Albert&#39;]</span>
<span class="go">S [&#39;Steven&#39;]</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>笛卡尔积<a class="headerlink" href="#id4" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id46">
<img alt="image-20211130101647105" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211130101647105.png" />
<figcaption>
<p><span class="caption-text">image-20211130101647105</span><a class="headerlink" href="#id46" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="id5">
<h2>集合运算<a class="headerlink" href="#id5" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">交</span>
<span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span>
<span class="n">a</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">并</span>
<span class="n">a</span> <span class="o">|</span> <span class="n">b</span>
<span class="n">a</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>


<span class="n">差</span>
<span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<span class="n">a</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="isinstance">
<h2>isinstance<a class="headerlink" href="#isinstance" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>

<span class="kc">True</span>

<span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
<span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2>查看对象所有方法与属性<a class="headerlink" href="#id6" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># 返回所有注释</span>

<span class="nb">dir</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># 只返回名字</span>
</pre></div>
</div>
</section>
<section id="is">
<h2>is / ==<a class="headerlink" href="#is" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ow">is</span> <span class="n">判断是否指向同一个对象</span>
<span class="o">==</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span>

<span class="c1"># a,b指向同一个对象</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="ow">is</span> <span class="n">b</span>
<span class="kc">True</span>


<span class="c1"># 对a做了修改，b也会变</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>   <span class="c1"># 会创建新的对象</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">a</span>
<span class="kc">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">==</span> <span class="n">a</span>
<span class="kc">True</span>

<span class="c1"># 作为list,每个位置上的元素相等，但是不是同一个对象</span>


<span class="c1"># A very common use of is and is not is to check if a variable is None, since there is</span>
<span class="c1"># only one instance of None:</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="format">
<h2>format<a class="headerlink" href="#format" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1"> </span><span class="si">{1:s}</span><span class="s1"> are worth US$</span><span class="si">{2:d}</span><span class="s1">&#39;</span>
<span class="n">template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">4.5560</span><span class="p">,</span> <span class="s1">&#39;Argentine Pesos&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="s1">&#39;4.56 Argentine Pesos are worth US$1&#39;</span>

<span class="n">seq</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a=</span><span class="si">{0}</span><span class="s1">, b=</span><span class="si">{1}</span><span class="s1">, c=</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>


<span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span>
<span class="n">a</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">6</span>
<span class="n">a</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">9</span>


<span class="n">n</span> <span class="o">=</span> <span class="s2">&quot;123&quot;</span>
<span class="n">n</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="s1">&#39;00123&#39;</span>
</pre></div>
</div>
</section>
<section id="list-list">
<h2>list 按另一个list排序<a class="headerlink" href="#list-list" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span>

<span class="p">([</span><span class="mi">59</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">66</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>

<span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">59</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id7">
<h2>速度解析<a class="headerlink" href="#id7" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that list concatenation by addition is a comparatively expensive operation since</span>
<span class="c1"># a new list must be created and the objects copied over. Using extend to append ele‐</span>
<span class="c1"># ments to an existing list, especially if you are building up a large list, is usually pref‐</span>
<span class="c1"># erable. Thus,</span>

<span class="n">everything</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">list_of_lists</span><span class="p">:</span>
    <span class="n">everything</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

<span class="c1"># is faster than the concatenative alternative:</span>

<span class="n">everything</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">list_of_lists</span><span class="p">:</span>
    <span class="n">everything</span> <span class="o">=</span> <span class="n">everything</span> <span class="o">+</span> <span class="n">chunk</span>
</pre></div>
</div>
</section>
<section id="try-raise">
<h2>try/raise<a class="headerlink" href="#try-raise" title="永久链接至标题"></a></h2>
<p>如果没有try,
raise有错误程序就会暂停，如果想让程序有错误仍能正常运行需要，需要用try
except 捕获异常</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;输入一个数：&quot;</span><span class="p">)</span>
    <span class="c1">#判断用户输入的是否为数字</span>
    <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a 必须是数字&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;引发异常：&quot;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
<section id="pandas">
<h3>pandas<a class="headerlink" href="#pandas" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="test-data">
<h2>test_data<a class="headerlink" href="#test-data" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
</pre></div>
</div>
</section>
<section id="id8">
<h2>打印显示列数<a class="headerlink" href="#id8" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="csv">
<h2>CSV读写<a class="headerlink" href="#csv" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 将dataframe转为csv保存到当前文件夹，自命名为file_name</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">source_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span>
                <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 读取csv</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;游戏路径.csv&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>


<span class="c1"># 指定读取列</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;2.csv&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>

<span class="c1"># 只读前n行</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;2.csv&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="excel">
<h2>Excel 读写<a class="headerlink" href="#excel" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;data.xlsx&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>



 <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">true_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">false_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">na_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">date_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thousands</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipfooter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">convert_float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mangle_dupe_cols</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>


<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;file_name.xlsx&#39;</span><span class="p">)</span>



<span class="n">DataFrame</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">excel_writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span> <span class="n">na_rep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">startrow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">startcol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge_cells</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inf_rep</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">freeze_panes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="n">source</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id9">
<h2>小数精度<a class="headerlink" href="#id9" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id10">
<h2>列转字典<a class="headerlink" href="#id10" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">a</span>

    <span class="mi">0</span>   <span class="mi">1</span>
<span class="mi">0</span>   <span class="mi">84</span>  <span class="mi">70</span>
<span class="mi">1</span>   <span class="mi">97</span>  <span class="mi">15</span>
<span class="mi">2</span>   <span class="mi">76</span>  <span class="mi">78</span>
<span class="mi">3</span>   <span class="mi">11</span>  <span class="mi">12</span>
<span class="mi">4</span>   <span class="mi">62</span>  <span class="mi">86</span>
<span class="mi">5</span>   <span class="mi">91</span>  <span class="mi">33</span>
<span class="mi">6</span>   <span class="mi">40</span>  <span class="mi">38</span>
<span class="mi">7</span>   <span class="mi">55</span>  <span class="mi">81</span>

<span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">j</span> <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()}</span>

<span class="p">{</span><span class="mi">84</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">97</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">76</span><span class="p">:</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">62</span><span class="p">:</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">91</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">55</span><span class="p">:</span> <span class="mi">81</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id11">
<h2>值统计<a class="headerlink" href="#id11" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 对一列元素计数，返回值及出现的次数</span>
<span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="c1">#统计各列nan的个数</span>
<span class="n">data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">data</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id12">
<h2>布尔值筛选<a class="headerlink" href="#id12" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 筛选满足条件的行</span>
<span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># label 非nan的行</span>
<span class="n">data</span><span class="p">[</span> <span class="o">~</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])]</span>

<span class="c1"># label 为nan的行</span>
<span class="n">data</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])]</span>

<span class="c1"># 布尔值筛选</span>
<span class="c1"># 不同的条件必须用()包裹起来,并或非分别使用&amp;,|,~而非and,or,not</span>
<span class="c1"># 不然会报错</span>
<span class="n">stripes_or_bars</span><span class="o">=</span><span class="n">flags</span><span class="p">[(</span><span class="n">flags</span><span class="p">[</span><span class="s1">&#39;stripes&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="s1">&#39;bars&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)]</span>

<span class="c1"># Series</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">a</span><span class="p">[</span><span class="n">b</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="list">
<h2>列是否在list中<a class="headerlink" href="#list" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">list1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id13">
<h2>分位数<a class="headerlink" href="#id13" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查看分位数</span>
<span class="n">data</span><span class="p">[[</span><span class="s1">&#39;num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="mf">10.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)]</span><span class="o">+</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.999</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">data</span><span class="p">[[</span><span class="s1">&#39;num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id14">
<h2>按list取行<a class="headerlink" href="#id14" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
<span class="n">row_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">row_list</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="id15">
<h2>相等比较<a class="headerlink" href="#id15" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas.testing</span> <span class="kn">import</span> <span class="n">assert_frame_equal</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">assert_frame_equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># 如果一样，不会返回任何东西，不一样会有差异分析</span>

<span class="c1">#作为dataframe整体是否相等的比较，返回一个bool</span>
<span class="n">a</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># 逐个元素比较，返回形状一样的dataframe,每个位置是bool值</span>
<span class="n">a</span><span class="o">==</span><span class="n">b</span>
<span class="n">a</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="append-concat">
<h2>append/ concat<a class="headerlink" href="#append-concat" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>行列和并堆叠

pd.concat([a,b],axis=1,ignore_index=False)

axis=1添加列，0添加行，ignore_index为True时，去掉原有的index或column,从0开始

a = pd.DataFrame(np.random.randint(1,10,size=[2,3]))
b = pd.DataFrame(np.random.randint(1,10,size=[2,3]))


    0   1   2
0   5   4   4
1   8   7   7

    0   1   2
0   3   9   7
1   9   6   9


pd.concat([a,b],axis=0,ignore_index=True)
    0   1   2
0   5   4   4
1   8   7   7
2   3   9   7
3   9   6   9

pd.concat([a,b],axis=1,ignore_index=True)

    0   1   2   3   4   5
0   5   4   4   3   9   7
1   8   7   7   9   6   9



a.append(b,ignore_index=True)

    0   1   2
0   5   4   4
1   8   7   7
2   3   9   7
3   9   6   9
</pre></div>
</div>
</section>
<section id="apply">
<h2>apply<a class="headerlink" href="#apply" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dataframe 对几列使用apply方法</span>
<span class="n">ans</span><span class="p">[</span><span class="s1">&#39;1_percent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sum_of_list</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;original_route&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 注意apply默认axis=0,此时的x是一列的数据，axis=1时是一行</span>


<span class="c1"># 根据dataframe a 某两列值的情况添加一列新的标签</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="cut-qcut">
<h2>cut/ qcut<a class="headerlink" href="#cut-qcut" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>def cut(
    x,
    bins,
    right: bool = True,
    labels=None,
    retbins: bool = False,
    precision: int = 3,
    include_lowest: bool = False,
    duplicates: str = &quot;raise&quot;,
    ordered: bool = True,
):

# duplicates : {default &#39;raise&#39;, &#39;drop&#39;}, optional
# If bin edges are not unique, raise ValueError or drop non-uniques.

bins = [0, 200, 1000, 5000, 10000]
# 按照给定区间 使用 pd.cut 将数据进行离散化
# 默认左开右闭 (0,200] &lt; (200,1000] &lt; (1000,5000] &lt; (5000,10000]
# 可以改为左闭右开
# 不在bins内的返回nan

# cut也可以直接将bins指定为int,则将值分为


# cut是保证每个区间的长度一样
# qcut是保证每个区间的元素个数一样


a = pd.DataFrame(np.random.normal(size=[10000,1]))
bins = [i/2 for i in range(-10,11)]
a[1] = pd.cut(a[0],bins=bins)
b = a.groupby(1,as_index=False)[0].count()
b.plot.bar(x= 1,y=0,color=&#39;lightblue&#39;, alpha=0.7)


d = pd.DataFrame([x**2 for x in range(11)])

    0
0   0
1   1
2   4
3   9
4   16
5   25
6   36
7   49
8   64
9   81
10  100

d_cut = d.copy()
d_cut[&#39;cut_group&#39;] =pd.cut(d_cut[0], 4)
d_cut

    0   cut_group
0   0   (-0.1, 25.0]
1   1   (-0.1, 25.0]
2   4   (-0.1, 25.0]
3   9   (-0.1, 25.0]
4   16  (-0.1, 25.0]
5   25  (-0.1, 25.0]
6   36  (25.0, 50.0]
7   49  (25.0, 50.0]
8   64  (50.0, 75.0]
9   81  (75.0, 100.0]
10  100 (75.0, 100.0]


def qcut(
    x,
    q,
    labels=None,
    retbins: bool = False,
    precision: int = 3,
    duplicates: str = &quot;raise&quot;,
):



d_qcut = d.copy()
d_qcut[&#39;qcut_group&#39;] = pd.qcut(d_qcut[0], 4)
d_qcut

    0   qcut_group
0   0   (-0.001, 6.5]
1   1   (-0.001, 6.5]
2   4   (-0.001, 6.5]
3   9   (6.5, 25.0]
4   16  (6.5, 25.0]
5   25  (6.5, 25.0]
6   36  (25.0, 56.5]
7   49  (25.0, 56.5]
8   64  (56.5, 100.0]
9   81  (56.5, 100.0]
10  100 (56.5, 100.0]

a  = pd.DataFrame()
lists = [1] * 5 + [2]* 10 + [3]* 15
a[0]=lists

pd.cut(a[0],3)不会报错
pd.qcut(a[0],3) 会

pd.qcut(a[0],3,duplicates=&#39;drop&#39;)

频率区间法：按照等频率或指定频率离散化
df[&#39;amount3&#39;] = pd.qcut(df[&#39;amount&#39;], 4, labels=[&#39;bad&#39;, &#39;medium&#39;, &#39;good&#39;, &#39;awesome&#39;])
</pre></div>
</div>
<figure class="align-default" id="id47">
<img alt="image-20211112143042092" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211112143042092.png" />
<figcaption>
<p><span class="caption-text">image-20211112143042092</span><a class="headerlink" href="#id47" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="drop-duplicates">
<h2>drop_duplicates<a class="headerlink" href="#drop-duplicates" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>DataFrame.drop_duplicates(subset=None, keep=&#39;first&#39;, inplace=False)



subset : column label or sequence of labels, optional
用来指定特定的列，默认所有列

keep : {‘first’, ‘last’, False}, default ‘first’
删除重复项并保留第一次出现的项

inplace : boolean, default False
是直接在原来数据上修改还是保留一个副本
</pre></div>
</div>
</section>
<section id="explode">
<h2>explode<a class="headerlink" href="#explode" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;等级&#39;</span><span class="p">:[</span><span class="s1">&#39;青铜&#39;</span><span class="p">,</span><span class="s1">&#39;王者&#39;</span><span class="p">,</span><span class="s1">&#39;皇冠&#39;</span><span class="p">],</span>
<span class="go">                     &#39;充值&#39;:[[10,10,10,9,9],[9,9,8,8,8,7,6],[7,6,6,6,5,5,4]]</span>
<span class="go">                    })</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>


<span class="go">    等级  充值</span>
<span class="go">0   青铜  [10, 10, 10, 9, 9]</span>
<span class="go">1   王者  [9, 9, 8, 8, 8, 7, 6]</span>
<span class="go">2   皇冠  [7, 6, 6, 6, 5, 5, 4]</span>


<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;充值&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>

<span class="go">    等级  充值</span>
<span class="go">0   青铜  10</span>
<span class="go">0   青铜  10</span>
<span class="go">0   青铜  10</span>
<span class="go">0   青铜  9</span>
<span class="go">0   青铜  9</span>
<span class="go">1   王者  9</span>
<span class="go">1   王者  9</span>
<span class="go">1   王者  8</span>
<span class="go">1   王者  8</span>
<span class="go">1   王者  8</span>
<span class="go">1   王者  7</span>
<span class="go">1   王者  6</span>
<span class="go">2   皇冠  7</span>
<span class="go">2   皇冠  6</span>
<span class="go">2   皇冠  6</span>
<span class="go">2   皇冠  6</span>
<span class="go">2   皇冠  5</span>
<span class="go">2   皇冠  5</span>
<span class="go">2   皇冠  4</span>

<span class="go"># 注意index</span>


<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>


<span class="go">    等级  充值  C</span>
<span class="go">0   青铜  10  1</span>
<span class="go">0   青铜  10  1</span>
<span class="go">0   青铜  10  1</span>
<span class="go">0   青铜  9   1</span>
<span class="go">0   青铜  9   1</span>
<span class="go">1   王者  9   1</span>
<span class="go">1   王者  9   1</span>
<span class="go">1   王者  8   1</span>
<span class="go">1   王者  8   1</span>
<span class="go">1   王者  8   1</span>
<span class="go">1   王者  7   1</span>
<span class="go">1   王者  6   1</span>
<span class="go">2   皇冠  7   1</span>
<span class="go">2   皇冠  6   1</span>
<span class="go">2   皇冠  6   1</span>
<span class="go">2   皇冠  6   1</span>
<span class="go">2   皇冠  5   1</span>
<span class="go">2   皇冠  5   1</span>
<span class="go">2   皇冠  4   1</span>
</pre></div>
</div>
</section>
<section id="fillna">
<h2>fillna()<a class="headerlink" href="#fillna" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DataFrame</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="groupby">
<h2>groupby<a class="headerlink" href="#groupby" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># 分组求和
# as_index = False是为了防止index变为multi-index
data.groupby([&quot;uid&quot;,&quot;desc_mpid&quot;],as_index = False).sum(&quot;cnt&quot;)
data.groupby([&quot;uid&quot;,&quot;desc_mpid&quot;],as_index = False).apply(sum)
# 效果一样，但第二条速度慢多了，没有默认函数的情况下再用apply




# 自定义函数，注意新建的columns的名字
data.groupby([&quot;uid&quot;,&quot;desc_mpid&quot;],as_index = False).apply(lambda x: sum(x[&#39;cnt&#39;]))


users.groupby(&quot;occupation&quot;).age.agg([&quot;min&quot;,&quot;max&quot;,&quot;mean&quot;])



company=[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;]

data=pd.DataFrame({
    &quot;company&quot;:[company[x] for x in np.random.randint(0,len(company),10)],
    &quot;salary&quot;:np.random.randint(5,50,10),
    &quot;age&quot;:np.random.randint(15,50,10)
}
)

data.groupby(&#39;company&#39;).agg({&#39;salary&#39;:&#39;median&#39;,&#39;age&#39;:&#39;mean&#39;})

         salary    age
company
A          21.5  27.50
B          10.0  29.00
C          30.0  27.25


将组内结算结果赋给每组的成员
一：

avg_salary_dict = data.groupby(&#39;company&#39;)[&#39;salary&#39;].mean().to_dict()
data[&#39;avg_salary&#39;] = data[&#39;company&#39;].map(avg_salary_dict)

二：

data.groupby(&#39;company&#39;)[&#39;salary&#39;].transform(&#39;mean&#39;)

    company  salary  age  avg_salary
0       C      43   35       29.25
1       C      17   25       29.25
2       C       8   30       29.25
3       A      20   22       21.50
4       B      10   17       13.00
5       B      21   40       13.00
6       A      23   33       21.50
7       C      49   19       29.25
8       B       8   30       13.00

# 对于groupby后的apply，以分组后的子DataFrame作为参数传入指定函数的，基本操作单位是DataFrame

def get_oldest_staff(x):
    df = x.sort_values(by = &#39;age&#39;,ascending=True)
    return df.iloc[-1,:]

data.groupby(&#39;company&#39;,as_index=False).apply(get_oldest_staff)

# 虽然说apply拥有更大的灵活性，但apply的运行效率会比agg和transform更慢。
# 所以，groupby之后能用agg和transform解决的问题还是优先使用这两个方法，
# 实在解决不了了才考虑使用apply进行操作



# 要实现多列统计不同的函数，只需要新建一个空的dataframe,然后每次添加计算结果作为新的一列即可


a = pd.DataFrame()

a[0] = ans.groupby(&#39;pt_dt&#39;).next_day.agg(&#39;count&#39;)
a[1] = ans.groupby(&#39;pt_dt&#39;).next_day.apply(label_count)
a[2] = a[1] / a[0]
a

                0   1   2
pt_dt
2021-11-01  300266  5542    0.018457
2021-11-02  297289  5238    0.017619
2021-11-03  297161  5337    0.017960
2021-11-04  294732  5065    0.017185
2021-11-05  298289  6111    0.020487
2021-11-06  296181  5865    0.019802
2021-11-07  295426  5949    0.020137
2021-11-08  296464  5385    0.018164
2021-11-09  293347  4971    0.016946
2021-11-10  292051  4981    0.017055
2021-11-11  290456  4759    0.016385
2021-11-12  291972  4758    0.016296
2021-11-13  288225  4944    0.017153
2021-11-14  288429  5082    0.017620
2021-11-15  298986  5564    0.018610
</pre></div>
</div>
</section>
<section id="group-concat">
<h2>group_concat<a class="headerlink" href="#group-concat" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:[</span><span class="s2">&quot;小明&quot;</span><span class="p">,</span><span class="s2">&quot;小明&quot;</span><span class="p">,</span><span class="s2">&quot;小明&quot;</span><span class="p">,</span><span class="s2">&quot;小红&quot;</span><span class="p">,</span><span class="s2">&quot;小张&quot;</span><span class="p">,</span><span class="s2">&quot;小张&quot;</span><span class="p">],</span>
  <span class="s2">&quot;score&quot;</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">500</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">df</span>

    <span class="n">name</span>    <span class="n">score</span>
<span class="mi">0</span>   <span class="n">小明</span>  <span class="mi">10</span>
<span class="mi">1</span>   <span class="n">小明</span>  <span class="mi">20</span>
<span class="mi">2</span>   <span class="n">小明</span>  <span class="mi">20</span>
<span class="mi">3</span>   <span class="n">小红</span>  <span class="mi">20</span>
<span class="mi">4</span>   <span class="n">小张</span>  <span class="mi">200</span>
<span class="mi">5</span>   <span class="n">小张</span>  <span class="mi">500</span>

<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;score&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span>

    <span class="n">score</span>
<span class="n">name</span>
<span class="n">小张</span>  <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">小明</span>  <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">小红</span>  <span class="p">[</span><span class="mi">20</span><span class="p">]</span>


<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;score&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">name</span>    <span class="n">score</span>
<span class="mi">0</span>   <span class="n">小张</span>  <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="mi">1</span>   <span class="n">小明</span>  <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="mi">2</span>   <span class="n">小红</span>  <span class="p">[</span><span class="mi">20</span><span class="p">]</span>


<span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">score</span><span class="p">))</span>

<span class="n">name</span>
<span class="n">小张</span>     <span class="mi">200</span><span class="p">;</span><span class="mi">500</span>
<span class="n">小明</span>    <span class="mi">10</span><span class="p">;</span><span class="mi">20</span><span class="p">;</span><span class="mi">20</span>
<span class="n">小红</span>          <span class="mi">20</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>


<span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
 <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">score</span><span class="p">))</span>
 <span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

    <span class="n">name</span>    <span class="n">score</span>
<span class="mi">0</span>   <span class="n">小张</span>  <span class="mi">200</span><span class="p">;</span><span class="mi">500</span>
<span class="mi">1</span>   <span class="n">小明</span>  <span class="mi">10</span><span class="p">;</span><span class="mi">20</span><span class="p">;</span><span class="mi">20</span>
<span class="mi">2</span>   <span class="n">小红</span>  <span class="mi">20</span>


<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;score&#39;</span><span class="p">:</span><span class="s1">&#39;unique&#39;</span><span class="p">})</span>

    <span class="n">score</span>
<span class="n">name</span>
<span class="n">小张</span>  <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">小明</span>  <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">小红</span>  <span class="p">[</span><span class="mi">20</span><span class="p">]</span>

<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;score&#39;</span><span class="p">:</span><span class="s1">&#39;unique&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">name</span>    <span class="n">score</span>
<span class="mi">0</span>   <span class="n">小张</span>  <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="mi">1</span>   <span class="n">小明</span>  <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="mi">2</span>   <span class="n">小红</span>  <span class="p">[</span><span class="mi">20</span><span class="p">]</span>


<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;score&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">})[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">name</span>    <span class="n">score</span>
<span class="mi">0</span>   <span class="n">小张</span>  <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
<span class="mi">1</span>   <span class="n">小明</span>  <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="mi">2</span>   <span class="n">小红</span>  <span class="p">[</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="insert">
<h2>insert<a class="headerlink" href="#insert" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
<span class="n">a</span>

    <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">0</span>   <span class="mi">4</span>   <span class="mi">1</span>   <span class="mi">7</span>
<span class="mi">1</span>   <span class="mi">7</span>   <span class="mi">8</span>   <span class="mi">4</span>
<span class="mi">2</span>   <span class="mi">6</span>   <span class="mi">1</span>   <span class="mi">7</span>
<span class="mi">3</span>   <span class="mi">4</span>   <span class="mi">9</span>   <span class="mi">1</span>
<span class="mi">4</span>   <span class="mi">5</span>   <span class="mi">9</span>   <span class="mi">7</span>

<span class="n">a</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pt_dt&#39;</span><span class="p">,</span><span class="s1">&#39;2021-12-01&#39;</span><span class="p">)</span>

    <span class="n">pt_dt</span>   <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">2</span>
<span class="mi">0</span>   <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">4</span>   <span class="mi">1</span>   <span class="mi">7</span>
<span class="mi">1</span>   <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">7</span>   <span class="mi">8</span>   <span class="mi">4</span>
<span class="mi">2</span>   <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">6</span>   <span class="mi">1</span>   <span class="mi">7</span>
<span class="mi">3</span>   <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">4</span>   <span class="mi">9</span>   <span class="mi">1</span>
<span class="mi">4</span>   <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">01</span>  <span class="mi">5</span>   <span class="mi">9</span>   <span class="mi">7</span>


<span class="c1"># 直接在原dataframe上操作，没有return</span>
</pre></div>
</div>
</section>
<section id="iterrows">
<h2>iterrows<a class="headerlink" href="#iterrows" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>df = pd.DataFrame({
    &#39;node1&#39;: [1, 2, 3],
    &#39;node2&#39;: [2, 3, 4]
})

for index, row in df.iterrows():
    print(index,row[&quot;node1&quot;],row[&quot;node2&quot;])

&gt;&gt;&gt; type(row)
&lt;class &#39;pandas.core.series.Series&#39;&gt;

既可以用 row[&#39;node1&#39;],也可以用 row[0]
</pre></div>
</div>
</section>
<section id="itertuples">
<h2>itertuples<a class="headerlink" href="#itertuples" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">break</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="join">
<h2>join<a class="headerlink" href="#join" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">size</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">size</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">t</span><span class="p">,</span><span class="n">mu</span>
<span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]))</span>

<span class="n">a</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="n">t</span><span class="p">,</span>
                <span class="s1">&#39;1&#39;</span><span class="p">:[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]})</span>
    <span class="mi">0</span>   <span class="mi">1</span>
<span class="mi">0</span>   <span class="mi">4</span>   <span class="mi">9</span>
<span class="mi">1</span>   <span class="mi">5</span>   <span class="mi">11</span>
<span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">7</span>
<span class="mi">3</span>   <span class="mi">0</span>   <span class="mi">1</span>
<span class="mi">4</span>   <span class="mi">2</span>   <span class="mi">5</span>
<span class="mi">5</span>   <span class="mi">1</span>   <span class="mi">3</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;7&#39;</span><span class="p">:</span><span class="n">mu</span><span class="p">,</span>
                <span class="s1">&#39;5&#39;</span><span class="p">:[</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mu</span><span class="p">]})</span>

    <span class="mi">7</span>   <span class="mi">5</span>
<span class="mi">0</span>   <span class="mi">0</span>   <span class="mi">4</span>
<span class="mi">1</span>   <span class="mi">1</span>   <span class="mi">5</span>
<span class="mi">2</span>   <span class="mi">4</span>   <span class="mi">20</span>
<span class="mi">3</span>   <span class="mi">3</span>   <span class="mi">13</span>
<span class="mi">4</span>   <span class="mi">2</span>   <span class="mi">8</span>
<span class="mi">5</span>   <span class="mi">5</span>   <span class="mi">29</span>

<span class="n">a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;7&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">5</span>
<span class="mi">0</span>   <span class="mi">4</span>   <span class="mi">9</span>   <span class="mi">20</span>
<span class="mi">1</span>   <span class="mi">5</span>   <span class="mi">11</span>  <span class="mi">29</span>
<span class="mi">2</span>   <span class="mi">3</span>   <span class="mi">7</span>   <span class="mi">13</span>
<span class="mi">3</span>   <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">4</span>
<span class="mi">4</span>   <span class="mi">2</span>   <span class="mi">5</span>   <span class="mi">8</span>
<span class="mi">5</span>   <span class="mi">1</span>   <span class="mi">3</span>   <span class="mi">5</span>
</pre></div>
</div>
</section>
<section id="map">
<h2>map<a class="headerlink" href="#map" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>Series 根据字典替换值

# python 自己也有map
# map()是一个 Python 内建函数，它允许你不需要使用循环就可以编写简洁的代码。


map(function, iterable, ...)
function - 针对每一个迭代调用的函数
iterable - 支持迭代的一个或者多个对象。在 Python 中大部分内建对象，例如 lists, dictionaries, 和 tuples 都是可迭代的。

当提供多个可迭代对象时，返回对象的数量大小和最短的迭代对象的数量一致

a = [1, 4, 6]
b = [2, 3, 5]

result = map(lambda x, y: x*y, a, b)

print(list(result))
</pre></div>
</div>
</section>
<section id="nan">
<h2>nan判断、统计<a class="headerlink" href="#nan" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># nan判断，可以放入值，series，dataframe</span>
<span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;label&#39;</span><span class="p">]])</span>

<span class="n">vertex_df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">uid</span>              <span class="mi">0</span>
<span class="n">is_loss</span>          <span class="mi">0</span>
<span class="n">city</span>         <span class="mi">38227</span>
<span class="n">member</span>      <span class="mi">667230</span>
<span class="n">battle</span>      <span class="mi">664506</span>
<span class="n">family</span>      <span class="mi">622684</span>
<span class="n">fan_club</span>    <span class="mi">614239</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
</section>
<section id="pivot">
<h2>pivot<a class="headerlink" href="#pivot" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;等级&#39;</span><span class="p">,</span><span class="s1">&#39;充值&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="n">等级</span>  <span class="n">充值</span>  <span class="n">C</span>
<span class="mi">0</span>   <span class="n">王者</span>  <span class="mi">6</span>   <span class="mi">1</span>
<span class="mi">1</span>   <span class="n">王者</span>  <span class="mi">7</span>   <span class="mi">1</span>
<span class="mi">2</span>   <span class="n">王者</span>  <span class="mi">8</span>   <span class="mi">3</span>
<span class="mi">3</span>   <span class="n">王者</span>  <span class="mi">9</span>   <span class="mi">2</span>
<span class="mi">4</span>   <span class="n">皇冠</span>  <span class="mi">4</span>   <span class="mi">1</span>
<span class="mi">5</span>   <span class="n">皇冠</span>  <span class="mi">5</span>   <span class="mi">2</span>
<span class="mi">6</span>   <span class="n">皇冠</span>  <span class="mi">6</span>   <span class="mi">3</span>
<span class="mi">7</span>   <span class="n">皇冠</span>  <span class="mi">7</span>   <span class="mi">1</span>
<span class="mi">8</span>   <span class="n">青铜</span>  <span class="mi">9</span>   <span class="mi">2</span>
<span class="mi">9</span>   <span class="n">青铜</span>  <span class="mi">10</span>  <span class="mi">3</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;等级&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;充值&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">data</span>

    <span class="mi">4</span>   <span class="mi">5</span>   <span class="mi">6</span>   <span class="mi">7</span>   <span class="mi">8</span>   <span class="mi">9</span>   <span class="mi">10</span>
<span class="n">王者</span>  <span class="n">NaN</span> <span class="n">NaN</span> <span class="mf">1.0</span> <span class="mf">1.0</span> <span class="mf">3.0</span> <span class="mf">2.0</span> <span class="n">NaN</span>
<span class="n">皇冠</span>  <span class="mf">1.0</span> <span class="mf">2.0</span> <span class="mf">3.0</span> <span class="mf">1.0</span> <span class="n">NaN</span> <span class="n">NaN</span> <span class="n">NaN</span>
<span class="n">青铜</span>  <span class="n">NaN</span> <span class="n">NaN</span> <span class="n">NaN</span> <span class="n">NaN</span> <span class="n">NaN</span> <span class="mf">2.0</span> <span class="mf">3.0</span>
</pre></div>
</div>
</section>
<section id="pivot-table">
<h2>pivot_table<a class="headerlink" href="#pivot-table" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pivot</span> <span class="n">只是reshape</span><span class="p">,</span> <span class="n">而pivot_table可以做各种统计计算</span>
</pre></div>
</div>
</section>
<section id="plot">
<h2>plot<a class="headerlink" href="#plot" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="mi">1</span>   <span class="n">balance</span>
<span class="mi">0</span>   <span class="p">(</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">]</span>  <span class="mi">8974</span>
<span class="mi">1</span>   <span class="p">(</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">]</span>   <span class="mi">6283</span>
<span class="mi">2</span>   <span class="p">(</span><span class="mf">200.0</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">]</span> <span class="mi">9590</span>
<span class="mi">3</span>   <span class="p">(</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">5000.0</span><span class="p">]</span>    <span class="mi">8224</span>
<span class="mi">4</span>   <span class="p">(</span><span class="mf">5000.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">]</span>   <span class="mi">2252</span>
<span class="mi">5</span>   <span class="p">(</span><span class="mf">10000.0</span><span class="p">,</span> <span class="mf">30000.0</span><span class="p">]</span>  <span class="mi">2841</span>
<span class="mi">6</span>   <span class="p">(</span><span class="mf">30000.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">]</span> <span class="mi">1641</span>
<span class="mi">7</span>   <span class="p">(</span><span class="mf">100000.0</span><span class="p">,</span> <span class="mf">300000.0</span><span class="p">]</span>    <span class="mi">860</span>
<span class="mi">8</span>   <span class="p">(</span><span class="mf">300000.0</span><span class="p">,</span> <span class="mf">500000.0</span><span class="p">]</span>    <span class="mi">196</span>
<span class="mi">9</span>   <span class="p">(</span><span class="mf">500000.0</span><span class="p">,</span> <span class="mf">519797860.0</span><span class="p">]</span> <span class="mi">657</span>

<span class="n">c</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">c</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
<span class="n">a</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span><span class="s1">&#39;Gray&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="rank">
<h2>rank<a class="headerlink" href="#rank" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rank</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">:</span> <span class="n">FrameOrSeries</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span>
    <span class="n">numeric_only</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">bool_t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">na_option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;keep&quot;</span><span class="p">,</span>
    <span class="n">ascending</span><span class="p">:</span> <span class="n">bool_t</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">pct</span><span class="p">:</span> <span class="n">bool_t</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrameOrSeries</span><span class="p">:</span>
</pre></div>
</div>
</section>
<section id="reindex">
<h2>reindex<a class="headerlink" href="#reindex" title="永久链接至标题"></a></h2>
</section>
<section id="reset-index">
<h2>reset_index<a class="headerlink" href="#reset-index" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 扔掉原有索引，重新建立从0到1的index, 若drop为False,则会将原index变为一列</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="replace">
<h2>replace<a class="headerlink" href="#replace" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 值替换</span>
<span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">70102</span><span class="p">,</span> <span class="mi">70115</span><span class="p">,</span> <span class="mi">70113</span><span class="p">,</span> <span class="mi">70144</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="c1"># 根据字典替换值</span>
<span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">dicts</span><span class="p">)</span>

<span class="c1"># 非nan替换为0，nan替换为1</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 注意 list 和 pandas.core.series.Series 的区别</span>
<span class="c1"># 当list长度为1时，可以del list[0],得到[], 而series 会报错</span>
<span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
<span class="ne">KeyError</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="series">
<h2>Series值替换<a class="headerlink" href="#series" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>new_df = df.replace({&quot;col1&quot;: column_dict})


df[&#39;col1&#39;] = df[&#39;col1&#39;].map(column_dict)

数据量大的情况下，map比 replace 快了不是一点点

replace是查找值，若值在dict里，则替换为对应的value,不在则保留
map是对每一个位置的元素做同样的操作
</pre></div>
</div>
</section>
<section id="shuffle">
<h2>shuffle<a class="headerlink" href="#shuffle" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="stack-unstack">
<h2>stack/unstack<a class="headerlink" href="#stack-unstack" title="永久链接至标题"></a></h2>
</section>
<section id="sort">
<h2>sort<a class="headerlink" href="#sort" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># dataframe 按某一列排序</span>
<span class="n">ret</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># 多列排序</span>
<span class="n">test</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ascending</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="to-numpy">
<h2>to_numpy()<a class="headerlink" href="#to-numpy" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="go">array([[1, 3],</span>
<span class="go">       [2, 4]])</span>
</pre></div>
</div>
</section>
<section id="unique-nunique">
<h2>unique/ nunique<a class="headerlink" href="#unique-nunique" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>

<span class="go">    0   1   2</span>
<span class="go">0   5   2   9</span>
<span class="go">1   1   6   2</span>
<span class="go">2   8   2   8</span>
<span class="go">3   9   3   8</span>
<span class="go">4   8   5   7</span>
<span class="go">5   4   1   6</span>
<span class="go">6   8   5   2</span>
<span class="go">7   9   8   6</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="go">array([5, 1, 8, 9, 4])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="go">5</span>
</pre></div>
</div>
<section id="numpy">
<h3>Numpy<a class="headerlink" href="#numpy" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="cumsum-cumprod">
<h2>cumsum/cumprod<a class="headerlink" href="#cumsum-cumprod" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)])</span>
<span class="n">a</span>

<span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>

<span class="n">a</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span>


<span class="n">a</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">5040</span><span class="p">,</span> <span class="mi">40320</span><span class="p">,</span><span class="mi">362880</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="np-maximum">
<h2>np.maximum<a class="headerlink" href="#np-maximum" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="choice-sample">
<h2>choice/ sample<a class="headerlink" href="#choice-sample" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">lists</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>


<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#从a(只要是ndarray都可以，但必须是一维的)中随机抽取数字，并组成指定大小(size)的数组</span>
<span class="c1">#replace:是否放回</span>
<span class="c1">#数组p：与数组a相对应，表示取数组a中每个元素的概率，默认为选取每个元素的概率相同。</span>
</pre></div>
</div>
</section>
<section id="basic-indexing-and-slicing">
<h2>Basic Indexing and Slicing<a class="headerlink" href="#basic-indexing-and-slicing" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>#  An important first distinction from Python’s built-in lists is that array slices
#  are views on the original array.
# This means that the data is not copied, and any modifications to the view will be
# reflected in the source array.

arr = np.arange(10)
arr

array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])

arr_slice = arr[5:8]
arr_slice

array([5, 6, 7])

arr_slice[1] = 12345
array([0, 1, 2, 3, 4, 5, 12345, 7, 8, 9])


If you want a copy of a slice of an ndarray instead of a view, you
will need to explicitly copy the array—for example,
arr[5:8].copy()
</pre></div>
</div>
</section>
<section id="np-arange">
<h2>np.arange 生成日期<a class="headerlink" href="#np-arange" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="s1">&#39;2019-07-06&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-10-12&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[M]&#39;</span><span class="p">)</span>
<span class="n">a</span>


<span class="n">datetime64</span> <span class="p">[</span><span class="n">Y</span><span class="p">]</span>  <span class="p">[</span><span class="n">M</span><span class="p">]</span> <span class="p">[</span><span class="n">W</span><span class="p">]</span> <span class="p">[</span><span class="n">D</span><span class="p">]</span> <span class="n">分别代表</span> <span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">week</span> <span class="n">day</span><span class="p">,</span>


<span class="n">h</span>   <span class="n">hour</span>
<span class="n">m</span>   <span class="n">minute</span>
<span class="n">s</span>   <span class="n">second</span>
<span class="n">ms</span>  <span class="n">millisecond</span>
<span class="n">us</span>  <span class="n">microsecond</span>
<span class="n">ns</span>  <span class="n">nanosecond</span>
<span class="n">ps</span>  <span class="n">picosecond</span>
<span class="n">fs</span>  <span class="n">femtosecond</span>
<span class="k">as</span>  <span class="n">attosecond</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">np</span><span class="o">.</span><span class="n">datetime_as_string</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># str(i)</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2021-10-01&#39;</span><span class="p">)</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">-</span><span class="n">delta</span>

<span class="n">numpy</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2021-05-14&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="np-where">
<h2>np.where<a class="headerlink" href="#np-where" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">yarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
<span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span>

<span class="n">array</span><span class="p">([</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>

<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
<section id="netwrokx">
<h3>NetwrokX<a class="headerlink" href="#netwrokx" title="永久链接至标题"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>任意可hash的对象都可以作为node,
可以重复添加节点，已有的不会被重新创建，
但是属性如果不一样了会被覆盖
添加edge时不需要node已经在graph中，不在的则会被创建
G.add_edge(1,2,year=0)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>NetworkX与igraph 都允许 一个节点到自己有边
不同之处在于，NetworkX中，一条边若已经存在，重复添加没有效果
而在igraph中允许两个节点间有多条边


Self loops are allowed but multiple (parallel) edges are not.
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">louvain社区发现算法需要下载包</span>

<span class="n">pip</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">louvain</span>
</pre></div>
</div>
</section>
</section>
<section id="id16">
<h2>测试数据<a class="headerlink" href="#id16" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50000</span><span class="p">)]</span>
<span class="n">test</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">lists</span><span class="p">)</span>
<span class="n">edge_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">lists</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">)]</span>
<span class="n">test</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edge_list</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id17">
<h2>可视化<a class="headerlink" href="#id17" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="dir-nx-graph">
<h2>dir(nx.Graph( ))<a class="headerlink" href="#dir-nx-graph" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__contains__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__delattr__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__dict__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__dir__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__doc__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__eq__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__format__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__ge__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__getattribute__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__getitem__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__gt__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__hash__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__init__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__init_subclass__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__iter__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__le__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__len__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__lt__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__module__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__ne__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__new__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__reduce__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__reduce_ex__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__repr__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__setattr__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__sizeof__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__str__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__subclasshook__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;__weakref__&#39;</span><span class="p">,</span>
 <span class="s1">&#39;_adj&#39;</span><span class="p">,</span>
 <span class="s1">&#39;_node&#39;</span><span class="p">,</span>
 <span class="s1">&#39;add_edge&#39;</span><span class="p">,</span>
 <span class="s1">&#39;add_edges_from&#39;</span><span class="p">,</span>
 <span class="s1">&#39;add_node&#39;</span><span class="p">,</span>
 <span class="s1">&#39;add_nodes_from&#39;</span><span class="p">,</span>
 <span class="s1">&#39;add_weighted_edges_from&#39;</span><span class="p">,</span>
 <span class="s1">&#39;adj&#39;</span><span class="p">,</span>
 <span class="s1">&#39;adjacency&#39;</span><span class="p">,</span>
 <span class="s1">&#39;adjlist_inner_dict_factory&#39;</span><span class="p">,</span>
 <span class="s1">&#39;adjlist_outer_dict_factory&#39;</span><span class="p">,</span>
 <span class="s1">&#39;clear&#39;</span><span class="p">,</span>
 <span class="s1">&#39;clear_edges&#39;</span><span class="p">,</span>
 <span class="s1">&#39;copy&#39;</span><span class="p">,</span>
 <span class="s1">&#39;degree&#39;</span><span class="p">,</span>
 <span class="s1">&#39;edge_attr_dict_factory&#39;</span><span class="p">,</span>
 <span class="s1">&#39;edge_subgraph&#39;</span><span class="p">,</span>
 <span class="s1">&#39;edges&#39;</span><span class="p">,</span>
 <span class="s1">&#39;get_edge_data&#39;</span><span class="p">,</span>
 <span class="s1">&#39;graph&#39;</span><span class="p">,</span>
 <span class="s1">&#39;graph_attr_dict_factory&#39;</span><span class="p">,</span>
 <span class="s1">&#39;has_edge&#39;</span><span class="p">,</span>
 <span class="s1">&#39;has_node&#39;</span><span class="p">,</span>
 <span class="s1">&#39;is_directed&#39;</span><span class="p">,</span>
 <span class="s1">&#39;is_multigraph&#39;</span><span class="p">,</span>
 <span class="s1">&#39;name&#39;</span><span class="p">,</span>
 <span class="s1">&#39;nbunch_iter&#39;</span><span class="p">,</span>
 <span class="s1">&#39;neighbors&#39;</span><span class="p">,</span>
 <span class="s1">&#39;node_attr_dict_factory&#39;</span><span class="p">,</span>
 <span class="s1">&#39;node_dict_factory&#39;</span><span class="p">,</span>
 <span class="s1">&#39;nodes&#39;</span><span class="p">,</span>
 <span class="s1">&#39;number_of_edges&#39;</span><span class="p">,</span>
 <span class="s1">&#39;number_of_nodes&#39;</span><span class="p">,</span>
 <span class="s1">&#39;order&#39;</span><span class="p">,</span>
 <span class="s1">&#39;remove_edge&#39;</span><span class="p">,</span>
 <span class="s1">&#39;remove_edges_from&#39;</span><span class="p">,</span>
 <span class="s1">&#39;remove_node&#39;</span><span class="p">,</span>
 <span class="s1">&#39;remove_nodes_from&#39;</span><span class="p">,</span>
 <span class="s1">&#39;size&#39;</span><span class="p">,</span>
 <span class="s1">&#39;subgraph&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_directed&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_directed_class&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_undirected&#39;</span><span class="p">,</span>
 <span class="s1">&#39;to_undirected_class&#39;</span><span class="p">,</span>
 <span class="s1">&#39;update&#39;</span><span class="p">]</span>

<span class="c1"># convert_matrix.py下，可以直接从dataframe导入edgelist</span>
<span class="p">[</span>
    <span class="s2">&quot;from_numpy_matrix&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_numpy_matrix&quot;</span><span class="p">,</span>
    <span class="s2">&quot;from_pandas_adjacency&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_pandas_adjacency&quot;</span><span class="p">,</span>
    <span class="s2">&quot;from_pandas_edgelist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_pandas_edgelist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_numpy_recarray&quot;</span><span class="p">,</span>
    <span class="s2">&quot;from_scipy_sparse_matrix&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_scipy_sparse_matrix&quot;</span><span class="p">,</span>
    <span class="s2">&quot;from_numpy_array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_numpy_array&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="create">
<h2>create<a class="headerlink" href="#create" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;node1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s1">&#39;node2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;node2&quot;</span><span class="p">)</span>


<span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">edge_df</span><span class="p">,</span> <span class="s2">&quot;uid0&quot;</span><span class="p">,</span> <span class="s2">&quot;uid1&quot;</span><span class="p">,</span><span class="n">edge_attr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="mf">7.98</span><span class="n">s</span>



<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edge_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge_df</span><span class="p">[</span><span class="s1">&#39;uid0&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">edge_df</span><span class="p">[</span><span class="s1">&#39;uid1&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">cnt</span><span class="o">=</span><span class="n">edge_df</span><span class="p">[</span><span class="s1">&#39;cnt&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
<span class="mf">25.9</span><span class="n">s</span>

<span class="c1"># networkx中没有index，现在edge list的顺序不是dataframe的顺序</span>
<span class="c1"># 会自己做优化，有排序</span>
<span class="c1"># 在计算common friends的时候，前期比较慢，后面特别快，可能是按邻居节点多少做了先后排序</span>

<span class="n">h</span><span class="o">.</span><span class="n">add_edge</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">add_node</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="attribute">
<h2>attribute<a class="headerlink" href="#attribute" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">()</span>
<span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">()</span>
<span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">()</span>
<span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">()</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">path_graph</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">edge_betweenness_centrality</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="s2">&quot;betweenness&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">][</span><span class="s2">&quot;betweenness&quot;</span><span class="p">]</span>
<span class="mf">2.0</span>


<span class="n">If</span> <span class="n">you</span> <span class="n">provide</span> <span class="n">a</span> <span class="nb">list</span> <span class="k">as</span> <span class="n">the</span> <span class="n">second</span> <span class="n">argument</span><span class="p">,</span> <span class="n">updates</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">will</span> <span class="n">be</span> <span class="n">reflected</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">edge</span> <span class="n">attribute</span> <span class="k">for</span> <span class="n">each</span> <span class="n">edge</span><span class="p">:</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">][</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
</pre></div>
</div>
<section id="igraph">
<h3>igraph<a class="headerlink" href="#igraph" title="永久链接至标题"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)])</span>
<span class="n">summary</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

<span class="n">IGRAPH</span> <span class="n">U</span><span class="o">---</span> <span class="mi">11</span> <span class="mi">3</span> <span class="o">--</span>
<span class="c1"># 这里是index</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>注意name中的字段并不具有唯一性，会被反复添加
</pre></div>
</div>
<figure class="align-default" id="id48">
<img alt="image-20211028203819776" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211028203819776.png" />
<figcaption>
<p><span class="caption-text">image-20211028203819776</span><a class="headerlink" href="#id48" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="create-1">
<span id="id18"></span><h2>create<a class="headerlink" href="#create-1" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="s1">&#39;google&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span><span class="s1">&#39;google&#39;</span><span class="p">,</span><span class="s1">&#39;apple&#39;</span><span class="p">]</span>
<span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span>


<span class="n">g</span><span class="o">.</span><span class="n">add_edges</span><span class="p">([(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span><span class="s1">&#39;apple&#39;</span><span class="p">),(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span><span class="s1">&#39;google&#39;</span><span class="p">)],{</span><span class="s1">&#39;label&#39;</span> <span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]})</span>


<span class="n">layout</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="s2">&quot;kk&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>


<span class="c1"># 通过edge端点的name得到该edge在es中的index</span>
<span class="n">g</span><span class="o">.</span><span class="n">get_eid</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span><span class="s1">&#39;google&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加单个节点</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="n">year</span> <span class="o">=</span> <span class="mi">203</span><span class="p">,</span><span class="n">gender</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span>

<span class="p">[</span><span class="n">igraph</span><span class="o">.</span><span class="n">Vertex</span><span class="p">(</span><span class="o">&lt;</span><span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x000001B6B1265048</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">203</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="mi">23</span><span class="p">})]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加多个节点</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">uid_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
<span class="n">gender</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uid_list</span><span class="p">),</span><span class="n">attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">uid_list</span><span class="p">,</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span><span class="n">gender</span><span class="p">})</span>
<span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">)</span>

<span class="p">[</span><span class="n">igraph</span><span class="o">.</span><span class="n">Vertex</span><span class="p">(</span><span class="o">&lt;</span><span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x000001B6B1265318</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}),</span>
 <span class="n">igraph</span><span class="o">.</span><span class="n">Vertex</span><span class="p">(</span><span class="o">&lt;</span><span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x000001B6B1265318</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}),</span>
 <span class="n">igraph</span><span class="o">.</span><span class="n">Vertex</span><span class="p">(</span><span class="o">&lt;</span><span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x000001B6B1265318</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}),</span>
 <span class="n">igraph</span><span class="o">.</span><span class="n">Vertex</span><span class="p">(</span><span class="o">&lt;</span><span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x000001B6B1265318</span><span class="o">&gt;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加单个edge</span>

<span class="n">g</span><span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="mi">2</span><span class="p">,{</span><span class="s1">&#39;name&#39;</span><span class="p">:[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span><span class="s1">&#39;google&#39;</span><span class="p">]})</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span><span class="s1">&#39;google&#39;</span><span class="p">,</span><span class="n">year</span><span class="o">=</span><span class="mi">34</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>


<span class="c1"># 添加多个edge</span>
<span class="c1"># 通过这种方式添加edge时，端点必须已经在vs里，不像NetworkX</span>
<span class="c1"># 但是在创建graph时可以只通过edge来创建</span>

<span class="n">g</span><span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_vertices</span><span class="p">(</span><span class="mi">5</span><span class="p">,{</span><span class="s1">&#39;name&#39;</span><span class="p">:[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">],</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">})</span>
<span class="c1"># g.add_edges([(1,2),(3,0)],{&#39;label&#39; :[3,4]})</span>
<span class="n">g</span><span class="o">.</span><span class="n">add_edges</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">),(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">)],{</span><span class="s1">&#39;label&#39;</span> <span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]})</span>


<span class="c1"># 从dataframe创建</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>



<span class="n">t</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">use_vids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">vertices</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>

<span class="c1"># df 的前两列是vertex, use_vids=True时，是vertex在图中的index，从0到t.vcount()</span>
<span class="c1"># vertices 是vertex的df,第一列是vertex的uid,不能有重复值，从上到下一次代表0到vcount()</span>
<span class="c1"># 列在图中的attribute是name</span>
<span class="c1"># 列是vertex的其他属性，attribute就是列名</span>
</pre></div>
</div>
</section>
<section id="plot-1">
<span id="id19"></span><h2>plot<a class="headerlink" href="#plot-1" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 画图</span>

<span class="n">layout</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="s2">&quot;kk&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mi">280</span><span class="p">,</span> <span class="mi">280</span><span class="p">))</span>
</pre></div>
</div>
<figure class="align-default" id="id49">
<img alt="image-20211028203436878" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211028203436878.png" />
<figcaption>
<p><span class="caption-text">image-20211028203436878</span><a class="headerlink" href="#id49" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="subgraph">
<h2>subgraph<a class="headerlink" href="#subgraph" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)])</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;i&#39;</span><span class="p">]</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="s2">&quot;kk&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>


<span class="n">h</span><span class="o">.</span><span class="n">get_edge_dataframe</span><span class="p">()</span>



<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="s2">&quot;kk&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plot</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>


<span class="c1"># 注意同样的节点在子图和原图中的index是不一样的，因为index始终是从0到n</span>

<span class="c1"># 按边创建子图</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">edge</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">6</span>

<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">vertex</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">vertex</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span><span class="o">==</span><span class="mi">1</span>

<span class="n">h_sub</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">subgraph_edges</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
<span class="n">h_sub</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">subgraph_edges</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">es</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">]))</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">subgraph_edges</span><span class="p">([</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">es</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">show</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>


<span class="c1"># 按节点创建子图</span>
<span class="n">h_sub1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">func1</span><span class="p">))</span>
<span class="n">h</span><span class="o">.</span><span class="n">subgraph</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">vs</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="bfs">
<h2>BFS<a class="headerlink" href="#bfs" title="永久链接至标题"></a></h2>
<p>(Breadth First Search)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 测试数据</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)])</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;i&#39;</span><span class="p">]</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="s2">&quot;kk&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>


<span class="n">h</span><span class="o">.</span><span class="n">bfs</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># 1. vertex的id遍历的顺序</span>
<span class="c1"># 2. 1中哪些index是新的一层</span>
<span class="c1"># 3. g.vs中按id,每个的(直系)parent是谁</span>

<span class="c1"># 2到3步内的点的index</span>
<span class="n">h</span><span class="o">.</span><span class="n">neighborhood</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mindist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="alter-attribute">
<h2>alter attribute<a class="headerlink" href="#alter-attribute" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">)])</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">vcount</span><span class="p">())]</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;b&#39;</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="s2">&quot;kk&quot;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span><span class="n">bbox</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>


<span class="c1"># no use, wrong</span>
<span class="n">h</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;b&#39;</span>
</pre></div>
</div>
<section id="notebook">
<h3>Notebook<a class="headerlink" href="#notebook" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="id20">
<h2>插件安装<a class="headerlink" href="#id20" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">jupyter_contrib_nbextensions</span> <span class="o">&amp;&amp;</span> <span class="n">jupyter</span> <span class="n">contrib</span> <span class="n">nbextension</span> <span class="n">install</span>
</pre></div>
</div>
<p>按照 jupyter notebook 的 extension 配置后，反而tab 提示模块和命令
功能不正常</p>
<p>查了一下有说 jedi
版本的，我这边环境依赖问题没办法直接改版本，发现有个魔术命令可以直接关闭调整jedi的功能
运行之后，环境正常了</p>
</section>
<section id="id21">
<h2>代码补全<a class="headerlink" href="#id21" title="永久链接至标题"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">config</span> <span class="n">Completer</span><span class="o">.</span><span class="n">use_jedi</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<section id="id22">
<h3>字符串操作<a class="headerlink" href="#id22" title="永久链接至标题"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 按行读取txt文件，避免文件过大，一次性读入占太多内存</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;input.txt&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c1"># 按指定字符将字符串分隔，返回list</span>
<span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>


<span class="c1"># 将第一个位置的（子）字符替换为第二个位置</span>
<span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># 判断是否存在指定子字符串直接用in</span>

<span class="s2">&quot;avg&quot;</span> <span class="ow">in</span> <span class="n">line</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="ml">
<h1>ML<a class="headerlink" href="#ml" title="永久链接至标题"></a></h1>
<p>Keras 损失函数：categorical_crossentropy,
sparse_categorical_crossentropy</p>
<p>的区别,见<a class="reference external" href="https://blog.csdn.net/CxsGhost/article/details/106095615?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.essearch_pc_relevant&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.essearch_pc_relevant">链接</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>如果 labels 是 one-hot 编码，用 categorical_crossentropy
one-hot 编码
　　[[0, 1, 0],
　　 [1, 0, 0],
　　 [0, 0, 1]]
每条每一行是一个label的编码，1所在的位置代表label

如果你的 tagets 是 数字编码 ，用 sparse_categorical_crossentropy
数字编码：[2, 0, 1, 5, 19]
每个数字就是label
</pre></div>
</div>
</section>
<section id="linux">
<h1>Linux<a class="headerlink" href="#linux" title="永久链接至标题"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 创建文件夹</span>
<span class="n">mkdir</span> <span class="n">name</span>

<span class="c1"># 移动文件</span>
<span class="n">move</span> <span class="n">name</span> <span class="p">[</span><span class="n">目标文件夹</span><span class="p">]</span>

<span class="c1"># 删除文件</span>
<span class="n">rm</span> <span class="p">[</span><span class="n">文件名</span><span class="p">]</span>

<span class="c1"># 删除目录(会询问是否删除子目录)</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span><span class="n">test</span>

<span class="c1"># 删除目录下所有文件</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">test</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#打开文件，若没有则新建</span>
<span class="n">vim</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">sql</span>

<span class="c1"># 首先按Esc退出编辑模式，保存文件并退出vim</span>
<span class="p">:</span><span class="n">wq</span>
<span class="c1"># (write,quit)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">crontab</span> <span class="o">-</span><span class="n">l</span>
<span class="n">查看当前用户下的定时任务</span>

<span class="n">crontab</span> <span class="o">-</span><span class="n">e</span>
<span class="n">新增或编辑定时任务</span>

<span class="mi">0</span> <span class="mi">9</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">luoxb</span> <span class="n">kinit</span> <span class="o">-</span><span class="n">kt</span> <span class="n">luoxb</span><span class="o">.</span><span class="n">keytab</span> <span class="n">luoxb</span>
<span class="n">每天早上9点运行命令</span>
</pre></div>
</div>
</section>
<section id="sql">
<h1>SQL<a class="headerlink" href="#sql" title="永久链接至标题"></a></h1>
<section id="my-uid">
<h2>my uid<a class="headerlink" href="#my-uid" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">929731696</span>
</pre></div>
</div>
</section>
<section id="id23">
<h2>服务器认证<a class="headerlink" href="#id23" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kinit</span> <span class="o">-</span><span class="n">kt</span> <span class="n">luoxb</span><span class="o">.</span><span class="n">keytab</span> <span class="n">luoxb</span>
</pre></div>
</div>
</section>
<section id="id24">
<h2>Notebook连接<a class="headerlink" href="#id24" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nohup</span> <span class="n">jupyter</span> <span class="n">notebook</span> <span class="o">&gt;</span> <span class="n">jupter</span><span class="o">.</span><span class="n">log</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">&amp;</span>
</pre></div>
</div>
</section>
<section id="hive-impala">
<h2>hive/impala 差别<a class="headerlink" href="#hive-impala" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>impala和hive两者有微妙的不同。

union all的时候，上下两部分都只有一个uid字段，但是上面字段名叫pid，下面叫uid，impala支持，但是hive会报错
</pre></div>
</div>
</section>
<section id="why-insert-data-is-forbidden-in-impala">
<h2>why insert data is forbidden in impala<a class="headerlink" href="#why-insert-data-is-forbidden-in-impala" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. impala 一次写入太多数据，会占用整个集群的资源，有可能引起整个集群的崩溃

2. impala 写入的数据也会自动同步到hive,但是不知道是什么时候，有可能写入了，但还没同步，会导致在hive里无法查到

3. 数据部分丢失
</pre></div>
</div>
</section>
<section id="explain">
<h2>explain<a class="headerlink" href="#explain" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">explain</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="p">....</span>
</pre></div>
</div>
</section>
<section id="create-table">
<h2>create table<a class="headerlink" href="#create-table" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>create table if not exists luoxb.test(
 round int,
 a int,
 b int,
 coin int
 ) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;\t&#39; LINES TERMINATED BY &#39;\n&#39; STORED AS textfile;


CSV文件的分割符 选  &#39;,&#39;
Txt 文件的分隔符 选  &#39;\t&#39;

# 将txt文件读入表中
load data inpath &#39;/user/luoxb/ne.txt&#39; overwrite into table luoxb.test


# 删除表
drop table if exists luoxb.test


# 将hive中创建的表同步到impala中，（只能）在impala中运行
INVALIDATE METADATA luoxb.test



load data inpath &#39;/user/yexh/0626newuser.csv&#39; overwrite into table zhangxiang.chunqiu_newuser partition(pt_dt=&#39;2019-06-26&#39;)
</pre></div>
</div>
</section>
<section id="invalidate-metadata">
<h2>INVALIDATE METADATA<a class="headerlink" href="#invalidate-metadata" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 清空表中数据，保留列，及其数据类型</span>

<span class="k">TRUNCATE</span> <span class="k">table_name</span>
</pre></div>
</div>
</section>
<section id="id25">
<h2>插入分区，删除分区，查看分区<a class="headerlink" href="#id25" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>CREATE TABLE IF NOT EXISTS luoxb.jjmall_promote_activity56_user(UID bigint,rnk bigint)
PARTITIONED BY(pt_dt string,classid int);


INSERT OVERWRITE TABLE luoxb.jjmall_promote_activity56_user
partition(pt_dt=&#39;2021-11-24&#39;,classid = 1)
SELECT *....;


# 只会删除指定分区
alter table luoxb.jjmall_promote_activity56_user
drop partition(pt_dt=&#39;2021-11-24&#39;,classid = 1);

alter table luoxb.jjmall_promote_activity56_user
drop partition(pt_dt=&#39;2021-11-24&#39;,classid in (1,2,3));

alter table tablename  drop partition(etl_dt&gt;=&#39;2018-01-01&#39;)


show partitions table_name
</pre></div>
</div>
</section>
<section id="id26">
<h2>查询结果建表<a class="headerlink" href="#id26" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>create table luoxb.lucky_0501_0820 as select * from ( )

-- 注意不能在with temp as ()之后

# 插入已有表（字段完全一样，只是增加行）
insert into tab1 select * from tab2
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>insert overwrite / insert into


两者都可以向 hive 表中插入数据，
但 insert into 操作是以追加的方式向 hive 表尾部追加数据，
而 insert overwrite 操作则是直接重写数据，即先删除 hive 表的数据，再执行写入操作。
注意，如果 hive 表是分区表的话，insert overwrite 操作只会重写当前分区的数据，不会重写其他分区数据。
</pre></div>
</div>
</section>
<section id="add-column">
<h2><a class="reference external" href="https://blog.csdn.net/Yvettre/article/details/80239531?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link">add column</a><a class="headerlink" href="#add-column" title="永久链接至标题"></a></h2>
<p>按Ctrl同时点击打开链接</p>
<p>[<a class="reference external" href="https://www.cnblogs.com/luxj/p/13352464.html">Hive列添加/更新/删除/虚拟列)</a></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span># 将查询结果作为新的一列添加到表中




---添加列
ALTER TABLE 表1 ADD [列1] INT ,[列2] INT

--- 在tb_student表额外添加一列 L3VPN，并且该L3VPN列含有默认值 apink，添加的位置在指定的列sex的后面
ALTER TABLE tb_student ADD l3vpn VARCHAR(10) DEFAULT &#39;apink&#39; AFTER sex


---使用alter命令在原表格test上创建新的字段new_data，数据类型为int，默认为NULL
---使用update、inner join、select共同实现更新值


alter table test add columns(new_data int);

insert overwrite table tablename
select a.col1,a.col2,b.col2
from tablename a join mastertable b on a.col3=b.col1


---可添加多个列，用逗号分隔开,可以添加注释
alter table test add columns(new_data int COMMENT &#39;商品销售信息表&#39;, pt_dt datetime);




--删除列
ALTER TABLE XXX DROP COLUMN Grade




INSERT INTO 表1([列1],[列2])
SELECT [列1],[列2] FROM 表2
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span># 修改列的位置
ALTER TABLE 表名 MODIFY 字段1 数据类型 FIRST|AFTER 字段2
</pre></div>
</div>
</section>
<section id="timestamp-to-date">
<h2>timestamp, to_date<a class="headerlink" href="#timestamp-to-date" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span># 注意hive 和 impala 里时间戳所在时区
# impala 里需要加8小时

from_utc_timestamp(from_unixtime(desc_ret,&quot;yyyy-MM-dd HH:mm:ss&quot;),&#39;PRC&#39;) as last_time

from_unixtime(desc_ret+ 8* 3600)
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>-- 指定日期之前60日

WHERE pt_dt BETWEEN to_date(date_sub(&quot;2021-08-01&quot;,60)) AND &quot;2021-08-01&quot;


-- 第一个日期-第二个日期

-- datediff(TIMESTAMP enddate, TIMESTAMP startdate)
-- Returns the number of days between two TIMESTAMP values.

datediff(&quot;2021-08-10&quot;,&quot;2021-08-01&quot;)

注意，使用
datediff(&quot;2021-08-22&quot;,pt_dt)&lt;= 30
时，包含的天数是2021-07-23之后的所有天数，计算会包括负数

0 &lt; datediff(&quot;2021-08-22&quot;,&quot;2021-08-22&quot;) &lt;= 3 得出来是True
从左往右计算，False &lt;= 3, False 记为 0
</pre></div>
</div>
</section>
<section id="id27">
<h2>本月最后一天<a class="headerlink" href="#id27" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">to_date</span><span class="p">(</span><span class="n">months_add</span><span class="p">((</span><span class="n">date_sub</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span> <span class="k">day</span><span class="p">(</span><span class="n">now</span><span class="p">()))),</span><span class="mi">1</span><span class="p">))</span>

<span class="c1">-- 上月最后一天</span>
<span class="n">to_date</span><span class="p">((</span><span class="n">date_sub</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span> <span class="k">day</span><span class="p">(</span><span class="n">now</span><span class="p">()))))</span>

<span class="c1">-- 本月第一天</span>
<span class="n">to_date</span><span class="p">((</span><span class="n">date_sub</span><span class="p">(</span><span class="n">now</span><span class="p">(),</span> <span class="k">day</span><span class="p">(</span><span class="n">now</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 想在sql中验证一个结算结果的值可以使用如下方法，</span>
<span class="c1">-- 选了，但是完全没选</span>
<span class="k">select</span> <span class="n">date_sub</span><span class="p">(</span><span class="ss">&quot;2021-08-25&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span><span class="ss">&quot;2021-08-22&quot;</span> <span class="k">as</span> <span class="n">label</span> <span class="k">from</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_game_rec_2ddz</span>
<span class="k">where</span> <span class="n">pt_dt</span> <span class="o">=</span> <span class="ss">&quot;2021-08-23&quot;</span>
<span class="k">limit</span> <span class="mi">10</span>
</pre></div>
</div>
</section>
<section id="last-value">
<h2>last_value<a class="headerlink" href="#last-value" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">temp</span> <span class="k">as</span> <span class="p">(</span>
<span class="k">SELECT</span> <span class="n">row_number</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">mp_id</span><span class="p">)</span> <span class="n">uid</span> <span class="k">from</span> <span class="n">dim</span><span class="p">.</span><span class="n">dim_product_info_d</span>
<span class="k">limit</span> <span class="mi">20</span>
<span class="p">)</span>
<span class="p">,</span><span class="n">temp1</span> <span class="k">as</span> <span class="p">(</span>
<span class="k">select</span> <span class="n">uid</span>
<span class="p">,</span><span class="n">uid</span> <span class="o">*</span> <span class="n">uid</span> <span class="k">as</span> <span class="n">day_gap_regist</span>
<span class="k">from</span> <span class="n">temp</span>
<span class="p">)</span>

<span class="p">,</span><span class="n">temp2</span> <span class="k">as</span> <span class="p">(</span>
<span class="k">select</span>
<span class="n">uid</span>
<span class="p">,</span> <span class="k">if</span><span class="p">(</span><span class="n">uid</span> <span class="k">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span><span class="k">null</span><span class="p">,</span><span class="n">day_gap_regist</span><span class="p">)</span> <span class="n">day_gap_regist</span>
<span class="k">from</span> <span class="n">temp1</span>
<span class="p">)</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="p">,</span><span class="n">last_value</span><span class="p">(</span><span class="n">day_gap_regist</span> <span class="k">ignore</span> <span class="n">nulls</span><span class="p">)</span>  <span class="n">over</span> <span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="n">uid</span><span class="p">)</span>  <span class="c1">--impala</span>
<span class="c1">-- ,last_value(day_gap_regist,True)  over (order by uid)  --hive</span>
<span class="k">from</span> <span class="n">temp2</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 要限制uid在指定集合中除了用</span>

<span class="k">where</span> <span class="n">uid</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">temp</span><span class="p">)</span>

<span class="c1">-- 还可以使用</span>

<span class="k">inner</span> <span class="k">join</span> <span class="k">on</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 打标签的方式，</span>
<span class="c1">-- 先把连接的键和label的值和名字拿出来，</span>
<span class="c1">-- 下面是取统计对应的值，全量的</span>
<span class="c1">-- 最后使用inner join 筛选</span>

<span class="k">left</span> <span class="k">join</span><span class="p">(</span>
    <span class="k">SELECT</span> <span class="k">distinct</span> <span class="n">t1</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span>
              <span class="mi">1</span> <span class="k">AS</span> <span class="n">if_ip_ab</span>
<span class="p">)</span>

<span class="c1">-- 没有的自动是null</span>

<span class="c1">-- 不需要用</span>
<span class="k">if</span><span class="p">(</span><span class="n">bool</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">case</span> <span class="k">when</span>
</pre></div>
</div>
</section>
<section id="id28">
<h2>连续时间窗口<a class="headerlink" href="#id28" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>join 表的时候，
on 后面跟的不只有 =
只要是bool值都可以



with temp as (
SELECT a.uid
,a.pt_dt
,b.uid is null as is_loss
from(
SELECT uid,pt_dt
from dw.dw_bal_user_match_stat_d
where pt_dt BETWEEN &#39;2021-10-09&#39; and date_add(&#39;2021-10-09&#39;,10)
GROUP BY uid,pt_dt
)a

LEFT JOIN (
SELECT uid,pt_dt
from dw.dw_bal_user_match_stat_d
where pt_dt BETWEEN &#39;2021-10-09&#39; and date_add(&#39;2021-10-09&#39;,10+16)
GROUP BY uid,pt_dt

)b

on a.uid = b.uid

and b.pt_dt BETWEEN date_add(a.pt_dt,1) and date_add(a.pt_dt,15)

GROUP BY a.uid,a.pt_dt,b.uid
)


select pt_dt, count(distinct uid),sum(is_loss),sum(is_loss) / count(distinct uid)
from temp
group by pt_dt
order by pt_dt
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">temp</span> <span class="k">as</span> <span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 去重</span>
<span class="n">distinct</span> <span class="n">和</span> <span class="n">group</span> <span class="n">by</span> <span class="n">效率</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 用impala 拉数据会少前101条数据，应该用hive</span>
</pre></div>
</div>
</section>
<section id="greatest-least">
<h2>greatest/ least<a class="headerlink" href="#greatest-least" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">chinese</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">english</span><span class="p">,</span>
    <span class="n">greatest</span> <span class="p">(</span><span class="n">chinese</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">english</span><span class="p">)</span> <span class="k">max</span><span class="p">,</span>
   <span class="n">least</span><span class="p">(</span><span class="n">chinese</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">english</span><span class="p">)</span> <span class="k">min</span>
 <span class="k">FROM</span> <span class="n">tb</span>
</pre></div>
</div>
</section>
<section id="id29">
<h2>结果保留两位小数 / 小数转百分数<a class="headerlink" href="#id29" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">cast</span><span class="p">(</span><span class="nb">number</span> <span class="k">as</span> <span class="nb">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">round</span><span class="p">(</span><span class="mi">12</span><span class="p">.</span><span class="mi">342</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>   <span class="mi">12</span><span class="p">.</span><span class="mi">34</span>
<span class="n">round</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>       <span class="mi">12</span>

<span class="k">cast</span><span class="p">(</span><span class="mi">10</span> <span class="k">as</span> <span class="nb">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>   <span class="mi">10</span><span class="p">.</span><span class="mi">00</span>


<span class="n">concat</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="k">cast</span><span class="p">((</span><span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">uid</span><span class="p">)</span><span class="o">/</span> <span class="n">dau</span><span class="p">)</span> <span class="o">*</span><span class="mi">100</span> <span class="k">as</span> <span class="nb">decimal</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="k">as</span> <span class="n">string</span><span class="p">),</span><span class="s1">&#39;%&#39;</span><span class="p">)</span> <span class="n">ratio</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>min 和 max 是取一列中的最大最小，
least(), greatest()
</pre></div>
</div>
</section>
<section id="id30">
<h2>类型转换, 模糊查询<a class="headerlink" href="#id30" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">where</span> <span class="k">cast</span><span class="p">(</span><span class="n">mp_id</span> <span class="k">as</span> <span class="n">string</span><span class="p">)</span> <span class="k">like</span> <span class="ss">&quot;501%&quot;</span>
</pre></div>
</div>
</section>
<section id="substring">
<h2>substring<a class="headerlink" href="#substring" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>substring(s，n，len)          n-开始位置，len-截取长度


SUBSTRING(&#39;computer&#39;,3)       mputer
SUBSTRING(&#39;computer&#39;,3,4)     mput
SUBSTRING(&#39;computer&#39;,-3)      ter
SUBSTRING(&#39;computer&#39;,-5,3)    put
</pre></div>
</div>
</section>
<section id="lpad-rpad">
<h2>lpad/rpad<a class="headerlink" href="#lpad-rpad" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>字符串补齐到指定长度，超过的截取


lpad(&quot;23&quot;,3,&quot;0&quot;),          023
lpad(&quot;123456&quot;,3,&quot;0&quot;),      123
rpad(&quot;12&quot;,3,&quot;0&quot;),          120
rpad(&quot;12345&quot;,3,&quot;0&quot;)        123
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>有分隔符字符串计数

name_list = &quot;hello,world,this,is&quot;

LENGTH(name_list)-LENGTH(REPLACE(name_list,&#39;,&#39;,&#39;&#39;))+1
</pre></div>
</div>
</section>
<section id="group-concat-1">
<span id="id31"></span><h2>group_concat<a class="headerlink" href="#group-concat-1" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="n">score</span> <span class="n">SEPARATOR</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">testgroup</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">id</span>


<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">score</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">testgroup</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">id</span>

<span class="c1">-- 目前impala 只支持distinct，不支持 order by</span>
<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">GROUP_CONCAT</span><span class="p">(</span><span class="n">score</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">testgroup</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">id</span>



<span class="k">SELECT</span> <span class="n">mac</span><span class="p">,</span><span class="n">group_concat</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">uid</span> <span class="k">as</span> <span class="n">string</span><span class="p">),</span><span class="ss">&quot;,&quot;</span><span class="p">)</span>
<span class="k">from</span>  <span class="n">dwm</span><span class="p">.</span><span class="n">dwm_usr_online_mac_d</span>
<span class="k">WHERE</span> <span class="n">pt_dt</span> <span class="o">=</span> <span class="ss">&quot;2021-10-01&quot;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">mac</span>
</pre></div>
</div>
<figure class="align-default" id="id50">
<img alt="image-20210908100301244" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210908100301244.png" />
<figcaption>
<p><span class="caption-text">image-20210908100301244</span><a class="headerlink" href="#id50" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id51">
<img alt="image-20210908100349719" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210908100349719.png" />
<figcaption>
<p><span class="caption-text">image-20210908100349719</span><a class="headerlink" href="#id51" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id52">
<img alt="image-20210908100442710" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210908100442710.png" />
<figcaption>
<p><span class="caption-text">image-20210908100442710</span><a class="headerlink" href="#id52" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="row-number">
<h2>row_number( )<a class="headerlink" href="#row-number" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span># 分组取前十

ROW_NUMBER() OVER (
    [PARTITION BY partition_expression, ... ]
    ORDER BY sort_expression [ASC | DESC], ...
)

PARTITION BY子句将结果集划分为分区。 ROW_NUMBER()函数分别应用于每个分区，并重新初始化每个分区的行号。PARTITION BY子句是可选的。如果未指定，ROW_NUMBER()函数会将整个结果集视为单个分区。

ORDER BY子句定义结果集的每个分区中的行的逻辑顺序。 ORDER BY子句是必需的，因为ROW_NUMBER()函数对顺序敏感


示例

SELECT
   ROW_NUMBER() OVER ( ORDER BY first_name) row_num,
   first_name,
   last_name,
   city
FROM
   sales.customers
</pre></div>
</div>
</section>
<section id="id32">
<h2>常用排名函数<a class="headerlink" href="#id32" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>rank() over()
1,1,1,4,4,6

dense_rank() over()
1,1,1,2,2,2,3,4

row_number() over()
1,2,3,4,5

percent_rank() over()
百分位排名，表示小于这个值的概率。最小值对应0，最大值对应1，null 会在最后
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 生成数据测试 percent_rank()对null,以及最大最小值的处理</span>

<span class="k">select</span> <span class="n">percent_rank</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">rank_num</span> <span class="k">from</span> <span class="p">(</span>
<span class="k">select</span> <span class="k">case</span>
<span class="k">when</span> <span class="n">user_score</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">then</span> <span class="mi">1</span>
<span class="k">when</span> <span class="n">user_score</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">and</span> <span class="n">user_score</span> <span class="o">&lt;</span><span class="mi">9</span> <span class="k">then</span> <span class="mi">4</span>
<span class="k">when</span> <span class="n">user_score</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="k">then</span> <span class="mi">19</span>
<span class="k">else</span> <span class="n">user_score</span> <span class="k">end</span> <span class="k">as</span> <span class="n">name</span> <span class="k">from</span> <span class="p">(</span>
<span class="k">select</span> <span class="k">distinct</span> <span class="n">user_score</span> <span class="k">from</span> <span class="n">risk_features</span><span class="p">.</span><span class="n">jjplat_rc_user_score_features</span>
<span class="k">where</span> <span class="n">pt_dt</span> <span class="o">=</span> <span class="ss">&quot;2021-08-22&quot;</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">user_score</span>
<span class="k">limit</span> <span class="mi">20</span>
<span class="p">)</span><span class="n">x</span>
<span class="p">)</span><span class="n">x</span><span class="p">;</span>


<span class="k">with</span> <span class="n">temp</span> <span class="k">as</span> <span class="p">(</span>
<span class="k">select</span> <span class="n">uid</span><span class="p">,</span><span class="n">recharge_30d</span> <span class="k">from</span> <span class="p">(</span>
<span class="k">select</span> <span class="k">distinct</span> <span class="n">uid</span> <span class="k">from</span> <span class="n">dw</span><span class="p">.</span><span class="n">dw_bal_user_match_stat_d</span>
<span class="k">where</span> <span class="n">pt_dt</span><span class="o">=</span><span class="ss">&quot;2021-09-18&quot;</span>
<span class="p">)</span><span class="n">a</span>
<span class="k">left</span> <span class="k">join</span><span class="p">(</span>
<span class="k">select</span> <span class="n">pid</span>
<span class="p">,</span><span class="k">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="n">datediff</span><span class="p">(</span><span class="ss">&quot;2021-09-18&quot;</span><span class="p">,</span><span class="n">pt_dt</span><span class="p">)</span><span class="o">&lt;=</span> <span class="mi">30</span><span class="p">,</span><span class="n">rmb_amount</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="n">recharge_30d</span>
<span class="k">from</span> <span class="n">security_dwd</span><span class="p">.</span><span class="n">dwd_app_acc_payin</span>
<span class="k">where</span> <span class="n">pt_dt</span><span class="o">=</span><span class="ss">&quot;2021-09-18&quot;</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">pid</span>
<span class="p">)</span><span class="n">b</span>

<span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">pid</span>
<span class="p">)</span>

<span class="p">,</span><span class="n">temp1</span> <span class="k">as</span> <span class="p">(</span>
<span class="k">select</span> <span class="n">recharge_30d</span>
<span class="k">from</span><span class="p">(</span>
<span class="k">select</span> <span class="n">recharge_30d</span><span class="p">,</span><span class="n">row_number</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span> <span class="n">partition</span> <span class="k">by</span> <span class="n">recharge_30d</span> <span class="k">order</span> <span class="k">by</span> <span class="n">recharge_30d</span><span class="p">)</span> <span class="k">as</span> <span class="n">row_num</span> <span class="k">from</span> <span class="n">temp</span>
<span class="k">where</span>
<span class="c1">-- recharge_30d is null or</span>
<span class="p">(</span><span class="n">recharge_30d</span> <span class="o">&lt;=</span> <span class="mi">1500</span> <span class="k">and</span> <span class="n">recharge_30d</span> <span class="o">&gt;=</span><span class="mi">1000</span><span class="p">)</span>
<span class="p">)</span><span class="n">x</span>
<span class="k">where</span> <span class="n">row_num</span> <span class="o">&lt;=</span><span class="mi">1</span>
<span class="p">)</span>


<span class="k">select</span> <span class="n">recharge_30d</span>
<span class="p">,</span><span class="n">percent_rank</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="n">recharge_30d</span><span class="p">)</span>
<span class="k">from</span> <span class="n">temp1</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">recharge_30d</span>
</pre></div>
</div>
<figure class="align-default" id="id53">
<img alt="image-20211018175419336" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211018175419336.png" />
<figcaption>
<p><span class="caption-text">image-20211018175419336</span><a class="headerlink" href="#id53" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id54">
<img alt="image-20211018175319922" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211018175319922.png" />
<figcaption>
<p><span class="caption-text">image-20211018175319922</span><a class="headerlink" href="#id54" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id55">
<img alt="image-20211018175216813" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211018175216813.png" />
<figcaption>
<p><span class="caption-text">image-20211018175216813</span><a class="headerlink" href="#id55" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">sum</span><span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="n">features_giveup</span> <span class="o">!=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

<span class="c1">-- 可以直接写为</span>

<span class="k">sum</span><span class="p">(</span><span class="n">features_giveup</span> <span class="o">!=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">-- 对bool值求和时，TRUE=1，FALSE=0</span>
<span class="c1">-- 不能用count，count只会统计有多少非Null的数据，true和false都会被计数</span>
</pre></div>
</div>
</section>
<section id="id33">
<span id="id34"></span><h2>速度解析<a class="headerlink" href="#id33" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>目前看来 left join / inner join 和 where 差别不大
但是在哪一步做限制很重要

比如30天日活和当天日活的交，如果在对局表dw.dw_bal_user_match_stat_d里直接对每一条数据判断是否是当日日活

这样判断的次数为 对局表30日的数据条数*当日日活数

如果对数据做完计算，按group by uid,之后再做限制，则判断次数为30日日活数乘以当日日活数
405359490  *  6436683 降到
 22639872  *  6436683



此外，行转列时

sum(if(game_id= 1002,match_time,0)) group by uid,
if(game_id=1002,sum(match_time),0)  group by uid,game_id

-- 时间从56/57s直接降到8s
-- 还需要group by uid, 对列求和




with temp as (
select uid,row_number() over (PARTITION BY uid order by mp_id ) mp_id,match_time match_time_day
from dw.dw_bal_user_match_stat_d
WHERE pt_dt = &quot;2021-11-01&quot;
and uid in (538571529,956203992,821539261)
)

-- select uid
-- ,if(mp_id = 1,sum(match_time_day),0)
-- ,if(mp_id = 2,sum(match_time_day),0)
-- ,if(mp_id = 3,sum(match_time_day),0)
-- from temp
-- group by uid,mp_id
-- order by uid;


SELECT uid
,sum(if(mp_id =1,match_time_day,0))  mp_1_time
,sum(if(mp_id =2,match_time_day,0))  mp_2_time
,sum(if(mp_id =3,match_time_day,0))  mp_3_time
from temp
group by uid;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>建立 erdou_day 时，用到两个中间表
一是uid 0,1互换，二是整理两个用户对局信息

最后得出单个用户信息统计
事实证明，将这两个中间表用with 表示，不如嵌套速度快，with在将查询结果写入表中
的时候根本跑不出来

不写入表，只查询的时候嵌套也比with表快，嵌套用了9s左右，with 12s
</pre></div>
</div>
</section>
<section id="select-1-1">
<h2>select 1+1<a class="headerlink" href="#select-1-1" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>想要验证结果时，可以直接select 1+1
不用加任何的from table
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>avg() 对 0 和 null的处理

null不会贡献分母，而零会
</pre></div>
</div>
</section>
<section id="infinity-nan">
<h2>infinity/nan<a class="headerlink" href="#infinity-nan" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span> <span class="n">nan</span>
<span class="mi">1</span><span class="o">/</span><span class="mi">0</span> <span class="n">infinity</span>
</pre></div>
</div>
</section>
<section id="id35">
<h2>分群重叠人数查看<a class="headerlink" href="#id35" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span># 对不同群分别标记 1,10,100,1000,10000
# uid,sum(label) group by uid

WITH temp as (
SELECT uid,sum(label) cnt
from(
    SELECT uid
    ,power(10,operationtype) label
    FROM dwd.dwd_op_msg_receipt_d_v3
    WHERE pt_dt  = &#39;2021-12-07&#39;
    and msgid = 6001540
    GROUP BY uid,operationtype

)x
GROUP BY uid
)

select cnt,count(DISTINCT uid) FROM temp
GROUP BY cnt
ORDER BY cnt
</pre></div>
</div>
</section>
</section>
<section id="algorithm">
<h1>Algorithm<a class="headerlink" href="#algorithm" title="永久链接至标题"></a></h1>
<figure class="align-default" id="id56">
<img alt="image-20210929104351801" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210929104351801.png" />
<figcaption>
<p><span class="caption-text">image-20210929104351801</span><a class="headerlink" href="#id56" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="neo4j">
<h1>Neo4j<a class="headerlink" href="#neo4j" title="永久链接至标题"></a></h1>
<figure class="align-default" id="id57">
<img alt="image-20210811172117899" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210811172117899.png" />
<figcaption>
<p><span class="caption-text">image-20210811172117899</span><a class="headerlink" href="#id57" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<p>使用 Louvain 算法对二斗用户进行社区发现时，关系建立为 春天的次数或coin,
undirected 比 natural/reverse</p>
<p>在同一个社区能包含更多的label，
但是包含的非label用户也更多，可以通过游戏单一性，vip等级作进一步筛除</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>注意在使用notebook,py2neo这种需要localhost的服务时，不能打开梯子
否则直接报错
</pre></div>
</div>
<p>删除neo4j里，project中的graph
database的时候，会将import中的csv一并删除，be careful</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apoc</span><span class="o">.</span><span class="n">import</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
<span class="n">apoc</span><span class="o">.</span><span class="n">import</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">use_neo4j_config</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<figure class="align-default" id="id58">
<img alt="image-20211103164914397" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211103164914397.png" />
<figcaption>
<p><span class="caption-text">image-20211103164914397</span><a class="headerlink" href="#id58" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">All</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">CSV</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">read</span> <span class="k">as</span> <span class="n">a</span> <span class="n">string</span><span class="p">,</span> <span class="n">so</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">use</span> <span class="n">toInteger</span><span class="p">(),</span> <span class="n">toFloat</span><span class="p">(),</span> <span class="n">split</span><span class="p">()</span> <span class="ow">or</span> <span class="n">similar</span> <span class="n">functions</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">values</span><span class="o">.</span>
</pre></div>
</div>
<p>It is generally *<strong>good practice to create some uniqueness
constraints*</strong> on the nodes to ensure that there are no duplicates. One
advantage of doing so is that this will create an index for the given
label and property. In addition to speeding up query searches for that
data, it will ensure that MERGE statements on nodes (such as the one
used in our load statement) are significantly faster.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">CONSTRAINT</span> <span class="n">ON</span> <span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Player</span><span class="p">)</span> <span class="n">ASSERT</span> <span class="n">a</span><span class="o">.</span><span class="n">uid</span> <span class="n">IS</span> <span class="n">UNIQUE</span>

<span class="n">DROP</span> <span class="n">CONSTRAINT</span> <span class="n">ON</span> <span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Player</span><span class="p">)</span> <span class="n">ASSERT</span> <span class="n">a</span><span class="o">.</span><span class="n">uid</span> <span class="n">IS</span> <span class="n">UNIQUE</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查看当前所有indexes &amp; constraints</span>

<span class="p">:</span><span class="n">schema</span>
</pre></div>
</div>
</section>
<section id="id36">
<h1>Excel<a class="headerlink" href="#id36" title="永久链接至标题"></a></h1>
<section id="vlookup">
<h2>VLOOKUP<a class="headerlink" href="#vlookup" title="永久链接至标题"></a></h2>
<div class="highlight-excel notranslate"><div class="highlight"><pre><span></span>=VLOOKUP(A2,$Q$2:$R$13411,2,FALSE)

四个参数分别为

查找值，
查找区域， 请记住，查阅值应该始终位于所在区域的第一列
返回查找区域中第几列的值，
近似匹配(TRUE)与精确匹配(FALSE)


绝对引用与相对引用

加$$符号的是绝对引用，可以单边绝对引用，表示固定行或列

remark: 在自动填充时，可以先将第一个参数所在的列复制，(注意不要清除内容)，
        然后将公式写在第一个位置
</pre></div>
</div>
<div class="highlight-excel notranslate"><div class="highlight"><pre><span></span>COUNT(A:A)
</pre></div>
</div>
</section>
<section id="alt-enter">
<h2>单元格换行 Alt+Enter<a class="headerlink" href="#alt-enter" title="永久链接至标题"></a></h2>
</section>
</section>
<section id="id37">
<h1>用户名单推送<a class="headerlink" href="#id37" title="永久链接至标题"></a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">luoxb</span><span class="o">/</span><span class="n">luoxb123321</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>INSERT OVERWRITE TABLE operations.op_topic_activity
PARTITION(topicid=56, batchid=93, pt_dt = &#39;2021-12-10&#39;, classid = 2)
SELECT cast(UID AS int) UID,
       &#39;&#39; AS extend
FROM  luoxb.jjmall_promote_activity56_user
WHERE pt_dt = &quot;2021-12-09&quot;
AND classid = 2
AND rnk &lt;= 50000;


#
topicid=56 and batchid=91 and pt_dt = &#39;2021-11-26&#39;
#


# 商城历次推送人数 各用户群人数

SELECT pt_dt
,sum(classid =1)
,sum(classid =2)
,sum(classid =3)
from luoxb.jjmall_promote_activity56_user
group by pt_dt
order by pt_dt
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>[!!!] 工单在 “执行人” 审核完毕后才能在DMP系统中推送名单，否则即使推送了，名单也会无法导入到业务平台中。



在查询用户群时，今天只能用昨天的pt_dt,

但写入推送表里的时候，分区必须写今天，才能保证事件分析系统里能看见





一次推送最好不要超过300万，超过的时候，先写入前300万数据，收到3封邮件之后，
用后面的数据重写推送表，用同样的分区，再次推送


推送前和马朝蕾确认一下吧，或者群里@马朝蕾 ，不要提前推送。尤其不要周五或周六晚上推送，
万一推送出问题，晚上不方便查，
不在时间内推送，推送失败，数据被丢掉
</pre></div>
</div>
<figure class="align-default" id="id59">
<img alt="image-20211220102847046" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211220102847046.png" />
<figcaption>
<p><span class="caption-text">image-20211220102847046</span><a class="headerlink" href="#id59" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id60">
<img alt="image-20211126110743161" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211126110743161.png" />
<figcaption>
<p><span class="caption-text">image-20211126110743161</span><a class="headerlink" href="#id60" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<p># Table_Info</p>
<section id="sns-sns-dw-member-snapshot-d">
<h2>sns.sns_dw_member_snapshot_d<a class="headerlink" href="#sns-sns-dw-member-snapshot-d" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">最后一天会包含之前所有的关系</span>


<span class="n">event_time</span> <span class="n">毫秒时间戳</span>
</pre></div>
</div>
<figure class="align-default" id="id61">
<img alt="image-20211105182015901" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211105182015901.png" />
<figcaption>
<p><span class="caption-text">image-20211105182015901</span><a class="headerlink" href="#id61" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id62">
<img alt="image-20211105182139160" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211105182139160.png" />
<figcaption>
<p><span class="caption-text">image-20211105182139160</span><a class="headerlink" href="#id62" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="sns-dwd-sns-transmsg-d-view">
<h2>sns.dwd_sns_transmsg_d_view<a class="headerlink" href="#sns-dwd-sns-transmsg-d-view" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>日志类型：**operation：sns_transmsg**
字段名称|类型|说明
:-|:-|:-
project|string| 数据分析系统使用：项目名称
event_name|string| 数据分析系统使用：事件名称
event_time|int|数据分析系统使用：事件时间，单位：毫秒
uid|int|数据分析系统使用：jj 用户ID[消息发送者]
sns_type|int|关系类型：参见关系类型(sns_type)含义说明
sns_pid|int|关系ID：参见关系类型(sns_type)含义说明（当sns_type为1时，为用户ID）
msg_type|int| 消息类型：1 文案 2 语音 3 图片 4 普通表情 5 特殊表情



select * from sns.dwd_sns_transmsg_d_view
where sns_type = &#39;1&#39;
and pt_dt &gt;= &#39;2021-11-01&#39;
and (uid = &#39;929731696&#39; or sns_pid = &#39;929731696&#39;);


# 数据类型全为string


    name            type               comment
1   billguid        string
2   pt_dt           string
3   project         string
4   event_name      string
5   event_time      string
6   uid             string
7   sns_type        string
8   sns_pid         string
9   msg_type        string
</pre></div>
</div>
<section id="id38">
<h3>推送接收表<a class="headerlink" href="#id38" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="dwd-dwd-op-msg-receipt-d-v3">
<h2>dwd.dwd_op_msg_receipt_d_v3<a class="headerlink" href="#dwd-dwd-op-msg-receipt-d-v3" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>    name    type    comment
1   msgid   int 消息ID
2   msgtype int 消息类型 1多播，2广播，3生发
3   uid int 用户ID
4   operationtype   int 回执类型 1接收，2阅读，3操作
5   receipttime string  回执返回时间，以达到MSGDetail的时间为准
6   pt_dt   string


# 1 接收 2 阅读 3 点击 4 发送


SELECT *
FROM dwd.dwd_op_msg_receipt_d_v3
WHERE pt_dt  &gt;= &#39;2021-12-02&#39;
and msgid = 6001540
and uid = 370143050
order by receipttime

# 注意去重

    msgid   msgtype uid operationtype   receipttime pt_dt
1   6001540 1   370143050   4   2021-12-07 19:45:44 2021-12-07
2   6001540 1   370143050   4   2021-12-07 19:45:44 2021-12-07
3   6001540 1   370143050   1   2021-12-07 19:45:45 2021-12-07
4   6001540 1   370143050   1   2021-12-07 19:45:52 2021-12-07
5   6001540 1   370143050   2   2021-12-07 20:08:50 2021-12-07
6   6001540 1   370143050   0   2021-12-07 20:08:53 2021-12-07
7   6001540 1   370143050   2   2021-12-07 21:16:34 2021-12-07
8   6001540 1   370143050   3   2021-12-07 21:16:36 2021-12-07
9   6001540 1   370143050   2   2021-12-07 21:16:38 2021-12-07


7.2.6.已发人数
MSG消息系统将消息发往接收终端的人数，已发人数≥接收人数。发送率：已发人数/导入数量。
7.2.7.接收人数
已经接收到该消息的用户数，已发人数≥接收人数≥已读人数。请注意：接收到消息不一定阅读，不能阅读可能与客户端展示机制或消息展示模式有关。接收率：接收人数/已发人数。
7.2.8.已读人数
接收到消息的用户中，客户端将消息展示给多少个用户或多少个用户读取到该消息，多次阅读只计数一次。已发人数≥接收人数≥已读人数≤阅读次数。阅读率：阅读人数/接收人数。

7.2.9.阅读次数
客户端将消息展示给用户，用户点击该消息的次数。Snackbar消息、普通弹窗、专题弹窗、动效弹窗等，由于用户只能点击一次，所以已读人数≈已读次数；活动专区挂牌或信箱消息等，用户可能点击多次，所以已读人数≤阅读次数。
7.2.10.动作点击人数
已经接收到该消息的用户数，已发人数≥接收人数≥已读人数。请注意：接收到消息不一定阅读，不能阅读可能与客户端展示机制或消息展示模式有关。
7.2.11.动作点击次数
    动作点击人数做了去重uid的处理，而动作点击次数未做去重uid的处理。
</pre></div>
</div>
<figure class="align-default" id="id63">
<img alt="image-20211123182521488" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211123182521488.png" />
<figcaption>
<p><span class="caption-text">image-20211123182521488</span><a class="headerlink" href="#id63" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>表里会有重复的uid


SELECT pt_dt
,sum(if(operationtype=4,num,0))
,sum(if(operationtype=1,num,0))
,sum(if(operationtype=2,num,0))
,sum(if(operationtype=0,num,0))
,sum(if(operationtype=3,num,0))
from(
SELECT pt_dt
,operationtype
,count(distinct uid) num
FROM dwd.dwd_op_msg_receipt_d_v3
WHERE pt_dt  &gt; = &#39;2021-12-04&#39;
and msgid = 6001540
GROUP BY pt_dt,operationtype
)x
GROUP BY pt_dt
order BY pt_dt;


SELECT pt_dt
,sum(operationtype=4)
,sum(operationtype=1)
,sum(operationtype=2)
,sum(operationtype=0)
,sum(operationtype=3)

FROM dwd.dwd_op_msg_receipt_d_v3
WHERE pt_dt  &gt; = &#39;2021-12-04&#39;
and msgid = 6001540
GROUP BY pt_dt
order by pt_dt;
</pre></div>
</div>
<section id="id39">
<h3>单局表<a class="headerlink" href="#id39" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="dwd-dwd-game-rec-2ddz">
<h2>dwd.dwd_game_rec_2ddz<a class="headerlink" href="#dwd-dwd-game-rec-2ddz" title="永久链接至标题"></a></h2>
<figure class="align-default" id="id64">
<img alt="image-20210916170923071" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210916170923071.png" />
<figcaption>
<p><span class="caption-text">image-20210916170923071</span><a class="headerlink" href="#id64" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id65">
<img alt="image-20210916170854216" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210916170854216.png" />
<figcaption>
<p><span class="caption-text">image-20210916170854216</span><a class="headerlink" href="#id65" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>-- 二斗录像表

features_giveup 记录的是投降的人的uid, 没有人投降则为0
features_abort   0代表未流局，1代表流局
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>注意对录像去重，desc_oid

当desc_oid 为null时，其余字段也全为null


由于比赛设置，会出现desc_oid一样，后面的字段不一样的情况
有的比赛是6轮2副牌，6轮6副牌，一轮是和同一个人打2/6副，就会解析为一个desc_oid

select distinct desc_mpid, desc_mn from (
select desc_oid,desc_mpid,desc_mn,count(*) as num from (
SELECT distinct desc_oid,features_seat1,features_seat0,desc_mpid,desc_mn,desc_rbt,desc_ret-desc_rbt
,features_seat_result1,features_seat_result0,features_updatemulti
,features_abort
,features_giveup
,features_spring

from dwd.dwd_game_rec_2ddz

where pt_dt = &quot;2021-08-22&quot;
)x
group by desc_oid,desc_mpid,desc_mn

having num &gt;1
order by num desc
)x
order by desc_mpid

--- 去找金融表里对应的数据，6副牌对应两条数据，分别是积分和金币奖励
select * from dwd.dwd_bal_user_deal_d
where pt_dt = &quot;2021-08-22&quot;
and pid = 340149980
and deal_subtype_id = 500403
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>同一个desc_mpid, desc_mn还有可能不一样
名字还是最后在dim表里去配


spring_win_uid / spring_win_cnt as unity_spring_win
group by uid,desc_mpid,desc_mn

就会出现infinity的情况，spring_win_uid始终大于0，而spring_win_cnt=0
</pre></div>
</div>
<figure class="align-default" id="id66">
<img alt="image-20210917203612753" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210917203612753.png" />
<figcaption>
<p><span class="caption-text">image-20210917203612753</span><a class="headerlink" href="#id66" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>二斗中，地主打一手牌认输会是春天
农民不能直接认输，至少打一手牌才能认输，这时不是春天
</pre></div>
</div>
</section>
<section id="dwd-dwd-usr-match-round-result">
<h2>dwd.dwd_usr_match_round_result<a class="headerlink" href="#dwd-dwd-usr-match-round-result" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dwd</span><span class="o">.</span><span class="n">dwd_usr_match_round_result</span>
</pre></div>
</div>
<figure class="align-default" id="id67">
<img alt="image-20210830101541672" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210830101541672.png" />
<figcaption>
<p><span class="caption-text">image-20210830101541672</span><a class="headerlink" href="#id67" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="event-dwd-usr-match-round-result">
<h2>event.dwd_usr_match_round_result<a class="headerlink" href="#event-dwd-usr-match-round-result" title="永久链接至标题"></a></h2>
<figure class="align-default" id="id68">
<img alt="image-20210909180530649" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210909180530649.png" />
<figcaption>
<p><span class="caption-text">image-20210909180530649</span><a class="headerlink" href="#id68" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id69">
<img alt="image-20210909180600291" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210909180600291.png" />
<figcaption>
<p><span class="caption-text">image-20210909180600291</span><a class="headerlink" href="#id69" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dwd-dwd-bal-user-deal-d">
<h2>dwd.dwd_bal_user_deal_d<a class="headerlink" href="#dwd-dwd-bal-user-deal-d" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- 具体字段意义见数仓说明文档

记录每次金币变动，时间精确到秒

包括报名缴费扣除、回兑、连胜奖励、付费表情

问题是连续打的时候，没有回兑不知道中间发生了什么
</pre></div>
</div>
<figure class="align-default" id="id70">
<img alt="image-20210913101559702" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210913101559702.png" />
<figcaption>
<p><span class="caption-text">image-20210913101559702</span><a class="headerlink" href="#id70" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dwd-dwd-bal-user-deal-vert-d">
<h2>dwd.dwd_bal_user_deal_vert_d<a class="headerlink" href="#dwd-dwd-bal-user-deal-vert-d" title="永久链接至标题"></a></h2>
<section id="id40">
<h3>日表<a class="headerlink" href="#id40" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="dw-dw-bal-deal-balance-d">
<h2>dw.dw_bal_deal_balance_d<a class="headerlink" href="#dw-dw-bal-deal-balance-d" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>记录用户在各个场次的收支情况
amount 代表输赢的金币数，cn中大的代表总次数，小的代表赢的次数


收支类型 operate
-- 1收入，2支出
-- 如需求净收入，需用收入数量减去支出数量
</pre></div>
</div>
<figure class="align-default" id="id71">
<img alt="image-20210824173033895" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210824173033895.png" />
<figcaption>
<p><span class="caption-text">image-20210824173033895</span><a class="headerlink" href="#id71" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id72">
<img alt="image-20210824173141199" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210824173141199.png" />
<figcaption>
<p><span class="caption-text">image-20210824173141199</span><a class="headerlink" href="#id72" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id73">
<img alt="image-20210824174231432" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210824174231432.png" />
<figcaption>
<p><span class="caption-text">image-20210824174231432</span><a class="headerlink" href="#id73" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dw-dw-bal-user-match-stat-d">
<h2>dw.dw_bal_user_match_stat_d<a class="headerlink" href="#dw-dw-bal-user-match-stat-d" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>末尾的_d代表这是日表，只有一天在场次信息的汇总，没有单局信息

coin_income, coin_pay, match_count, champion_cnt
对应于 amount,cn 两列中的四个数
（对于打一局就结算的比赛是这样，可以打多局的仍需确认）
（一局结算的也有count部分数据对应不上，需注意）

通过看自己的数据，
</pre></div>
</div>
<figure class="align-default" id="id74">
<img alt="image-20210824174331000" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210824174331000.png" />
<figcaption>
<p><span class="caption-text">image-20210824174331000</span><a class="headerlink" href="#id74" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id75">
<img alt="image-20210824173642408" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210824173642408.png" />
<figcaption>
<p><span class="caption-text">image-20210824173642408</span><a class="headerlink" href="#id75" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dw-dw-bal-account-balance-d">
<h2>dw.dw_bal_account_balance_d<a class="headerlink" href="#dw-dw-bal-account-balance-d" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>用户账户信息表：记录当日有交易的用户的账户信息

业务覆盖范围：棋牌类游戏

currency_id 货币类型 =2 时代表JJ金币
-- 关联 dim.dim_currency_type 的 id字段
注意一个用户一天中可能有多条记录

acc_type账户类型 与 acc_num账户号
一个pid下可能有多个账户,所以即使是指定了currency_id=2，仍然会有多条记录

SELECT * from dw.dw_bal_account_balance_d
where pid = 949734032 and pt_dt = &quot;2021-10-01&quot;


查询uid下金币最多账户的余额
select pid
,max(balance) as balance
from dw.dw_bal_account_balance_d
where pt_dt = &quot;2021-10-01&quot; and currency_id =2
group by pid
</pre></div>
</div>
<figure class="align-default" id="id76">
<img alt="image-20211020140214391" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211020140214391.png" />
<figcaption>
<p><span class="caption-text">image-20211020140214391</span><a class="headerlink" href="#id76" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dw-dw-usr-retain-d">
<h2>dw.dw_usr_retain_d<a class="headerlink" href="#dw-dw-usr-retain-d" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>留存

stat_type = datediff(pt_dt,retain_dt)

pt_dt 是今天，retain_dt 代表用户那天也有玩游戏
</pre></div>
</div>
<figure class="align-default" id="id77">
<img alt="image-20211112154040663" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20211112154040663.png" />
<figcaption>
<p><span class="caption-text">image-20211112154040663</span><a class="headerlink" href="#id77" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dwd-dwd-usr-workorder-d">
<h2>dwd.dwd_usr_workorder_d<a class="headerlink" href="#dwd-dwd-usr-workorder-d" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">投诉工单</span>
</pre></div>
</div>
</section>
<section id="dm-dm-losscallback-width-d">
<h2>dm.dm_losscallback_width_d<a class="headerlink" href="#dm-dm-losscallback-width-d" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 统计每天 距上次online距今 [15,600] 天的用户，</span>
<span class="c1"># 注意是online,不是游戏</span>

<span class="c1"># loss_days = datediff(pt_dt,last_online_date)</span>

    <span class="n">name</span>    <span class="nb">type</span>    <span class="n">comment</span>
<span class="mi">1</span>   <span class="n">uid</span> <span class="nb">int</span>
<span class="mi">2</span>   <span class="n">last_online_date</span>    <span class="n">string</span>
<span class="mi">3</span>   <span class="n">loss_days</span>   <span class="nb">int</span>
<span class="mi">4</span>   <span class="n">total_recharge</span>  <span class="nb">int</span>
<span class="mi">5</span>   <span class="n">score</span>   <span class="nb">int</span>
<span class="mi">6</span>   <span class="n">qiuka_balance</span>   <span class="nb">int</span>
<span class="mi">7</span>   <span class="n">gold_balance</span>    <span class="nb">int</span>
<span class="mi">8</span>   <span class="n">most_match_exchange</span> <span class="n">string</span>
<span class="mi">9</span>   <span class="n">qiuka_expend_most</span>   <span class="n">string</span>
<span class="mi">10</span>  <span class="n">activity_match_if</span>   <span class="nb">int</span>
<span class="mi">11</span>  <span class="n">match_level_pre</span> <span class="nb">int</span>
<span class="mi">12</span>  <span class="n">loss_game_pre</span>   <span class="n">string</span>
<span class="mi">13</span>  <span class="n">exchange_coin_amount</span>    <span class="n">double</span>
<span class="mi">14</span>  <span class="n">pt_dt</span>   <span class="n">string</span>
</pre></div>
</div>
<figure class="align-default" id="id78">
<img alt="image-20211202170159553" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211202170159553.png" />
<figcaption>
<p><span class="caption-text">image-20211202170159553</span><a class="headerlink" href="#id78" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<section id="id41">
<h3>商城<a class="headerlink" href="#id41" title="永久链接至标题"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>商城兑奖查询日期在operations.op_topic_activity表里日期第二天开始，连续三天

比如12-03推送，查询效果是在12-04到12-06
</pre></div>
</div>
</section>
</section>
<section id="dwd-dwd-jjmall-order-info-new">
<h2>dwd.dwd_jjmall_order_info_new<a class="headerlink" href="#dwd-dwd-jjmall-order-info-new" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>1   orserialid  int 序号 自增
2   orderid string  订单ID        #
3   uid int 用户ID        #
4   membermark  int 会员标识（0：非会员，1：会员）
5   viplevel    int 会员等级

6   storeid int 店铺ID  #

7   storename   string  店铺名称
8   terminaltype    int 终端类型
9   ostype  int 操作系统类型
10  devtype int 设备类型
11  deviceos    string  操作系统和版本号
12  devicehardware  string  设备厂商和型号
13  zoneid  int 下单入口信息
14  addressprovince string  收货人省
15  addresscity string  收货人市
16  addresscounty   string  收货人县
17  addresstown string  收货人镇

18  commodityform   int 商品形态（2：实物，3：数字产品）  #

19  commoditysubform    int 商品子形态（0：无子形态，1：话费）
20  relserialid string  业务流水号
21  orderfreight    int 订单运费金额（单位：分）
22  expectdate  string  期望送达日期


23  orderstate  int 订单状态        #
24  orderresult int 订单结果，如果订单失败，表示失败原因      #


25  ordertime   string  下单时间
26  finishpaymenttime   string  支付完成时间
27  examineflag int 是否审核（0：不审核，1：审核）
28  procedureid int 步骤标识（0：审核未完成，1：审核完成，2：待向仓储确认下单，3：向仓储确认下单中，4：向仓储确认下单完成，5：待向采购推单，6：向采购推单中，7：采购推单完成）
29  spitnum int 拆单数量
30  ordercommcount  int 订单商品数量
31  userinvisiable  int 用户不可见标识，0：可见；1：不可见
32  updatereason    string  订单状态修改原有
33  useractivity    int 用来标记用户参与的活动
34  status  int 数据状态（0：有效，1：无效）
35  ctime   string  创建时间     #
36  mtime   string  修改时间
37  note    string  订单备注信息
38  pt_dt   string
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>with temp as (
select a.orderid
,a_label
,b_label
from(
    select distinct orderid
    , 1 as a_label
    from dwd.dwd_jjmall_order_info_new
    where pt_dt = &#39;2021-12-01&#39;
)a

full join(
    select distinct orderid
    , 2 as b_label
    from dwd.dwd_jjmall_sub_order_info_new
    where pt_dt = &#39;2021-12-01&#39;
)b

on a.orderid = b.orderid

)

select count(distinct orderid),sum(a_label is null),sum(b_label is null) from temp



    count(distinct orderid) sum(a_label is null)    sum(b_label is null)
1   62173510    1185    5393873

by Kimmie : 是否拆分子订单是根据供货商，存在没有子订单的情形
</pre></div>
</div>
</section>
<section id="dwd-dwd-jjmall-sub-order-info-new">
<h2>dwd.dwd_jjmall_sub_order_info_new<a class="headerlink" href="#dwd-dwd-jjmall-sub-order-info-new" title="永久链接至标题"></a></h2>
<p>count(suborderid) = count(orderid)</p>
<p>可能是共同作为主键</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>1   suborderid  string  子订单ID
2   orderid string  订单ID OrderInfo.OrderID
3   uid int 用户ID
4   membermark  int 会员标识（0：非会员，1：会员）
5   viplevel    int 会员等级
6   storeid int 店铺ID     ##
7   storename   string  店铺名称
8   terminaltype    int 终端类型
9   ostype  int 操作系统类型

17  commodityform   int 商品形态（2：实物，3：数字产品）      ##
18  commoditysubform    int 商品子形态（0：无子形态，1：话费）

22  orderstate  int 订单状态
23  orderresult int 订单结果，如果订单失败，表示失败原因

35  pt_dt   string


storeid:店铺ID
0: 大厅店铺
1：消消店铺
2：qa店铺
3：曙光店铺
4：春秋店铺
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">orderstate</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">orderid</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_jjmall_sub_order_info_new</span>
<span class="k">WHERE</span> <span class="n">pt_dt</span> <span class="o">=</span> <span class="s1">&#39;2021-12-03&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">orderstate</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">orderstate</span><span class="p">;</span>
</pre></div>
</div>
<figure class="align-default" id="id79">
<img alt="image-20211204114843821" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211204114843821.png" />
<figcaption>
<p><span class="caption-text">image-20211204114843821</span><a class="headerlink" href="#id79" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id80">
<img alt="image-20211204120039538" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211204120039538.png" />
<figcaption>
<p><span class="caption-text">image-20211204120039538</span><a class="headerlink" href="#id80" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id81">
<img alt="image-20211204160519987" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211204160519987.png" />
<figcaption>
<p><span class="caption-text">image-20211204160519987</span><a class="headerlink" href="#id81" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<p>orderid 与 suborderid</p>
<p>按子订单个数对订单分组 去重计数</p>
<figure class="align-default" id="id82">
<img alt="image-20211204115901772" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211204115901772.png" />
<figcaption>
<p><span class="caption-text">image-20211204115901772</span><a class="headerlink" href="#id82" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dwd-dwd-jjmall-order-comm-info-new">
<h2>dwd.dwd_jjmall_order_comm_info_new<a class="headerlink" href="#dwd-dwd-jjmall-order-comm-info-new" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>    name    type    comment
1   ordercomminfoid int 订单商品明细ID
2   orderid string  订单ID OrderInfo.OrderID
3   suborderid  string  子订单ID SubOrderInfo.SubOrderID
4   commodityid string  商品SKU
5   commodityname   string  商品名称
6   commodityssku   string  供应商SKU
7   commodityspec   string  商品规格
8   commodityunit   string  商品销售单位
9   commoditytaxtype    string  商品税别
10  commoditytaxrate    string  商品税率
11  commodityu8code string  商品U8编码
12  commodityform   int 商品形态（2：实物，3：数字产品:）


13  commsubform int 商品子形态（0：无子形态，1：话费）     ##

14  commoditycount  int 商品数量

15  facevalue   int 面额（单位：分）      # 商品单价


16  commoditytype   int 商品类型（1：商品，2：赠品、3 基底商品）
17  commodityfreight    int 商品承担运费金额（单位：分，注：赠品不承担运费）
18  commodityweight int 商品重量
19  supplierid  int 供应商ID
20  supplierorderno string  供货商采购单号
21  waybill string  物流单号
22  returnstate int 标识是否退货（0：没退，1：已退）
23  status  int 数据状态（0：有效，1：无效）
24  ctime   string  创建时间（固定）
25  mtime   string  修改时间（固定）
26  note    string  备注信息
27  pt_dt    string
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>一个orderid 下面 suborderid 里所有商品的commodityform 一定是一样的

SELECT orderid,count(DISTINCT commodityform) cnt from
dwd.dwd_jjmall_order_comm_info_new
where pt_dt = &#39;2021-12-01&#39;
GROUP BY orderid
ORDER BY cnt desc


一个suborderid 可能对应多行数据，commodityname 可以有多种

SELECT suborderid, count(DISTINCT commodityname) cnt
from dwd.dwd_jjmall_order_comm_info_new
where pt_dt = &#39;2021-12-01&#39;
GROUP BY suborderid
ORDER BY cnt desc

    suborderid  cnt
1   NULL    2937
2   102110152055275887289501    27
3   102111201050156121503801    25
4   102109201010475691140801    25
5   102110281438585971273201    21
6   102104011901304532405401    20
7   102108272339305515561101    20
8   102006221945371795285602    20
9   102111170454516100277401    20
10  102104261331104777019501    20



with temp as (
select
b1.orderid
,b1.suborderid
,directiontype
,b2.ctime
,b1.commodityform
,commodityname
,facevalue
,oriid
,currencyname
,singleprice
,b2.commoditycount
,originalamount
,reduceamount
,dealamount
from (
    SELECT *
    FROM dwd.dwd_jjmall_order_comm_info_new
    where pt_dt = &#39;2021-12-01&#39;
)b1


left join (
    SELECT *
    FROM dwd.dwd_jjmall_order_comm_price_info_new
    where pt_dt = &#39;2021-12-01&#39;
)b2

on b1.orderid = b2.orderid
and b1.commodityid =b2.commodityid

)

select * from temp
where orderid = &#39;102104011901304532405400&#39;
order by suborderid



    singleprice commoditycount  originalamount  reduceamount    dealamount
    2300        2                   4600    600     4000
    1000        2                   2000    200     1800
    3900        2                    7800   1000    6800
    1800        2                   3600    200     3400
    5400        1                   5400    600     4800
    2400        1                   2400    200     2200

    singleprice * commoditycount = originalamount

    originalamount - reduceamount = dealamount


    suborderid                      ctime           commodityname   facevalue   oriid   currencyname
102104011901304532405401    2021-04-01 19:01:30.413 雀巢罐装中老年奶粉850g   9290    889 秋卡
102104011901304532405401    2021-04-01 19:01:30.413 雀巢罐装中老年奶粉850g   9290    100 人民币
102104011901304532405401    2021-04-01 19:01:30.413 金龙鱼物理压榨葵花籽油6.18L    9250    889 秋卡
102104011901304532405401    2021-04-01 19:01:30.413 金龙鱼物理压榨葵花籽油6.18L    9250    100 人民币
102104011901304532405401    2021-04-01 19:01:30.43  柴火大院稻花香米东北大米5kg 5600    889 秋卡
102104011901304532405401    2021-04-01 19:01:30.43  柴火大院稻花香米东北大米5kg 5600    100 人民币
102104011901304532405402    2021-04-01 19:01:30.43  JJ双层高硼硅玻璃茶杯升级款  3600    889 秋卡
102104011901304532405402    2021-04-01 19:01:30.43  JJ双层高硼硅玻璃茶杯升级款  3600    100 人民币
102104011901304532405402    2021-04-01 19:01:30.43  JJ泡茶师高硼硅分离玻璃杯升级款    4250    889 秋卡
102104011901304532405402    2021-04-01 19:01:30.43  JJ泡茶师高硼硅分离玻璃杯升级款    4250    100 人民币
102104011901304532405403    2021-04-01 19:01:30.413 JJ无芯卷纸3层*100g*12卷   1790    889 秋卡
102104011901304532405403    2021-04-01 19:01:30.413 JJ无芯卷纸3层*100g*12卷   1790    100 人民币
102104011901304532405403    2021-04-01 19:01:30.413 如水鱼皮花生500g  2790    889 秋卡
102104011901304532405403    2021-04-01 19:01:30.413 如水鱼皮花生500g  2790    100 人民币




一个orderid 是否生成suborderid是根据供货商的不同
一般orderid 末两位是00， suborderid末两位从01开始
102003161028570975617400    102003161028570975617401

一个suborderid 也会有多行记录，对应不种货币

秋卡+人民币的购买方式，依商品而定，没有固定的 秋卡/人民币  转换汇率
同样数量的秋卡，在不同的商品中折算的人民币数量不一样
</pre></div>
</div>
</section>
<section id="dwd-dwd-jjmall-order-comm-price-info-new">
<h2>dwd.dwd_jjmall_order_comm_price_info_new<a class="headerlink" href="#dwd-dwd-jjmall-order-comm-price-info-new" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>一个suborderid 也会有多条记录，对应不同货币支付金额


有1/10的suborderid 为 null


    name                    type                comment
1   ordercommpriceid         int                订单商品货币价格ID
2   orderid                 string              订单ID或子订单ID OrderInfo.OrderID
3   ordercomminfoid          int                订单商品明细ID OrderCommDetail.OrderCommInfoID
4   suborderid              string               子订单ID SubOrderInfo.SubOrderID
5   commodityid             string              商品SKU


6   directiontype           int                 方向，-1：支付，1：赠送


7   dtid                    int                 数据D
8   atid    int 数据A


9   oriid   int 数据O
10  currencyname    string  数据名称


11  dataid  string  业务方支付数据ID
12  singleprice int 单价（原价）
13  commoditycount  int 商品数量
14  originalamount  int 总价（原价）
15  reduceamount    int 优惠减掉的价格
16  dealamount  int 交易价
17  status  int 数据状态（0：有效，1：无效）
18  ctime   string  创建时间（固定）
19  mtime   string  修改时间（固定）
20  note    string  备注信息
21  pt_dt   string
</pre></div>
</div>
</section>
<section id="dwd-dwd-jjmall-order-payment-info">
<h2>dwd.dwd_jjmall_order_payment_info<a class="headerlink" href="#dwd-dwd-jjmall-order-payment-info" title="永久链接至标题"></a></h2>
<p>日表，不是全量</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1   orderpaymentinfoid  int 订单支付明细ID
2   orderid string  订单ID
3   directiontype   int 方向，-1：支付，1：赠送
4   paymenttimes    int 支付次数
5   dtid    int 数据D
6   atid    int 数据A
7   oriid   int 数据O
8   currencyname    string  数据名称
9   dataid  string  业务方支付货币ID
10  belonging   int 数据归属，1：平台；2：业务
11  originalamount  int 原价
12  reduceamount    int 优惠减掉的价格
13  dealamount  int 交易价
14  headpaymentamount   int 首付应付数量
15  tailpaymentamount   int 尾款应付数量
16  payedamount int 已支付数量
17  paymentchannel  int 支付渠道
18  paymentmethod   string  支付方式
19  paymentmode int 支付模式
20  bankid  int 银行类型
21  ecaid   int 订单执行的ECA方案ID
22  ecagroupid  int 订单执行的ECA方案分组ID
23  status  int 数据状态（0：有效，1：无效）
24  ctime   string  创建时间（固定）
25  mtime   string  修改时间（固定）
26  note    string  订单商品备注信息
27  pt_dt   string
</pre></div>
</div>
</section>
<section id="id42">
<h2>售后表<a class="headerlink" href="#id42" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_jjmall_aftersale_commodity_dao_new</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_jjmall_aftersale_commodity_info_new</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_jjmall_aftersale_order_dao_new</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_jjmall_aftersale_order_new</span><span class="p">;</span>
</pre></div>
</div>
<section id="id43">
<h3>信息维度表<a class="headerlink" href="#id43" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="dim-dim-product-info-d">
<h2>dim.dim_product_info_d<a class="headerlink" href="#dim-dim-product-info-d" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dim</span><span class="o">.</span><span class="n">dim_product_info_d</span>
</pre></div>
</div>
<figure class="align-default" id="id83">
<img alt="image-20210827104737636" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210827104737636.png" />
<figcaption>
<p><span class="caption-text">image-20210827104737636</span><a class="headerlink" href="#id83" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dim-dim-ware-info-v2">
<h2>dim.dim_ware_info_v2 ( 物品维表)<a class="headerlink" href="#dim-dim-ware-info-v2" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">oriid</span><span class="p">,</span><span class="n">currencyname</span>
    <span class="k">from</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_jjmall_order_comm_price_info_new</span>
    <span class="k">where</span> <span class="n">pt_dt</span> <span class="o">=</span> <span class="s1">&#39;2021-11-17&#39;</span>
<span class="p">)</span> <span class="n">t1</span>
<span class="k">left</span> <span class="k">join</span> <span class="n">dim</span><span class="p">.</span><span class="n">dim_ware_info_v2</span> <span class="n">t2</span>
<span class="k">on</span> <span class="n">t1</span><span class="p">.</span><span class="n">oriid</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">type_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">oriid</span>
</pre></div>
</div>
<figure class="align-default" id="id84">
<img alt="image-20211124110740925" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211124110740925.png" />
<figcaption>
<p><span class="caption-text">image-20211124110740925</span><a class="headerlink" href="#id84" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    oriid   currencyname
1   2       金币
2   88      福卡
3   100     人民币
4   505     手机话费直充50元
5   506     手机话费直充30元
6   510     手机话费充值百元兑换券
7   889     秋卡
8   889     秋卡抵扣
9   1741    10元手机充值卡
10  3118    100元京东兑换券
11  3142    小海豚蓝(专用）
12  3142    小海豚蓝
13  3186    1元手机充值卡
14  3187    5元手机充值卡
15  3307    2元手机充值卡
</pre></div>
</div>
</section>
<section id="dim-dim-currency-type">
<h2>dim.dim_currency_type<a class="headerlink" href="#dim-dim-currency-type" title="永久链接至标题"></a></h2>
<figure class="align-default" id="id85">
<img alt="image-20211124112958322" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211124112958322.png" />
<figcaption>
<p><span class="caption-text">image-20211124112958322</span><a class="headerlink" href="#id85" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dim-dim-company-area-code">
<h2>dim.dim_company_area_code<a class="headerlink" href="#dim-dim-company-area-code" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>SELECT prov_id,prov_name from dim.dim_company_area_code
GROUP BY prov_id,prov_name
ORDER BY prov_id


SELECT * from dim.dim_company_area_code
where country_id = 511325



    prov_id  prov_name  city_id  city_name  country_id  country_name
1   510000   四川省     511300   南充市      511325       西充县
</pre></div>
</div>
</section>
<section id="dim-dim-company-prov-code">
<h2>dim.dim_company_prov_code<a class="headerlink" href="#dim-dim-company-prov-code" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>与上面的区别是只有31个省、市、自治区，不含港澳台
</pre></div>
</div>
<section id="id44">
<h3>用户登录注册表<a class="headerlink" href="#id44" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="dwd-dwd-usr-register-d">
<h2>dwd.dwd_usr_register_d<a class="headerlink" href="#dwd-dwd-usr-register-d" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>select uid,pt_dt from dwd.dwd_usr_register_d
group by uid,pt_dt

一个uid可能有不只一条记录
</pre></div>
</div>
</section>
<section id="dwd-dwd-usr-online-v2-d">
<h2>dwd.dwd_usr_online_v2_d<a class="headerlink" href="#dwd-dwd-usr-online-v2-d" title="永久链接至标题"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dwd.dwd_usr_online_v2_d


注意一个用户一天可能通过多个平台登录

clientplatid 平台id


-- 可以用于区分各个平台的登录，
TK_PTID_ENUM_RESERVE = 0,    //保留
TK_PTID_ENUM_MOBILE  = 1,    //手机大厅
TK_PTID_ENUM_FLASH   = 2,    //flash（停用）
TK_PTID_ENUM_LOBBY   = 3,    //PC大厅
TK_PTID_ENUM_WEB  = 4,    //JJ官网
TK_PTID_ENUM_WEBGAME = 5,     //webgame，网页游戏，对应的appid为70万+
TK_PTID_ENUM_OPENID = 6,     //OPENID
TK_PTID_ENUM_SNSID = 7,     //海豚
TK_PTID_ENUM_MLOAD = 8,     // MLoad （没用）
TK_PTID_ENUM_JJSDK = 9,     // JJSDK，联运或自研游戏
TK_PTID_ENUM_JJBOX = 10,    // JJBOX
TK_PTID_ENUM_WXGAME = 11,    // 微信游戏平台
TK_PTID_ENUM_H5GAME = 12,    // 美团游戏平台
TK_PTID_ENUM_PROMOTE = 13,    // 推广产品平台
TK_PTID_ENUM_DYGAME = 14,     // 抖音游戏平台
TK_PTID_ENUM_LONGHU = 15,     // 龙湖小程序平台
TK_PTID_ENUM_DIDIGAME = 16,     // 滴滴游戏
</pre></div>
</div>
<figure class="align-default" id="id86">
<img alt="image-20210830163800573" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210830163800573.png" />
<figcaption>
<p><span class="caption-text">image-20210830163800573</span><a class="headerlink" href="#id86" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dw-dw-usr-game-last-i">
<h2>dw.dw_usr_game_last_i<a class="headerlink" href="#dw-dw-usr-game-last-i" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- 拉链表，保存全量用户的状态，将用户状态切分为 “开始日期 ---&gt; 结束日期” 和 “开始 ---&gt; 2099-12-31”</span>

<span class="c1">-- 注意这里的pt_dt 只到月</span>

<span class="c1">-- 目的是为了对数据做分区，查询的时候指定分区，避免全表扫，加快查询速度</span>

<span class="c1">-- 全量表，每天都会更新用户当前时间在各个mp_id最后玩的情况</span>

<span class="c1">-- 同月内没有变化，pt_dt 不更新不会增加新的行，跨月还没有变化才会增加行</span>


<span class="c1">-- 2021-11-30 之前玩过1094的用户</span>


<span class="k">select</span> <span class="k">distinct</span>  <span class="n">uid</span>
<span class="k">from</span> <span class="n">dw</span><span class="p">.</span><span class="n">dw_usr_game_last_i</span>
<span class="k">where</span> <span class="n">pt_dt</span> <span class="o">=</span> <span class="s1">&#39;2021-11&#39;</span>
<span class="k">and</span> <span class="n">s_date</span> <span class="o">&lt;=</span> <span class="s1">&#39;2021-11-30&#39;</span>
<span class="k">and</span> <span class="n">e_date</span> <span class="o">&gt;=</span> <span class="s1">&#39;2021-11-30&#39;</span>
<span class="k">and</span> <span class="n">game_id</span><span class="o">=</span><span class="mi">1094</span>
</pre></div>
</div>
<figure class="align-default" id="id87">
<img alt="image-20210901145819192" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210901145819192.png" />
<figcaption>
<p><span class="caption-text">image-20210901145819192</span><a class="headerlink" href="#id87" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">b</span><span class="p">.</span><span class="n">mp_name</span> <span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="o">*</span> <span class="k">from</span><span class="p">(</span>
<span class="k">select</span> <span class="n">mp_id</span>
<span class="p">,</span><span class="n">match_begin_date</span>
<span class="p">,</span><span class="n">match_time</span>
<span class="p">,</span><span class="n">s_date</span>
<span class="p">,</span><span class="n">pt_dt</span>
<span class="p">,</span><span class="n">e_date</span>
<span class="k">from</span> <span class="n">dw</span><span class="p">.</span><span class="n">dw_usr_game_last_i</span>
<span class="k">where</span> <span class="n">pt_dt</span> <span class="o">=</span> <span class="s1">&#39;2021-11&#39;</span>
<span class="k">and</span> <span class="n">s_date</span> <span class="o">&lt;=</span> <span class="s1">&#39;2021-11-05&#39;</span>
<span class="k">and</span> <span class="n">e_date</span> <span class="o">&gt;=</span> <span class="s1">&#39;2021-11-05&#39;</span>
<span class="k">and</span> <span class="n">uid</span> <span class="o">=</span><span class="mi">929731696</span>
<span class="p">)</span><span class="n">a</span>

<span class="k">left</span> <span class="k">join</span><span class="p">(</span>
<span class="k">select</span> <span class="n">mp_id</span><span class="p">,</span><span class="n">mp_name</span>
<span class="k">from</span> <span class="n">dim</span><span class="p">.</span><span class="n">dim_product_info_d</span>
<span class="p">)</span><span class="n">b</span> <span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">mp_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">mp_id</span>
<span class="k">order</span> <span class="k">by</span>
<span class="n">s_date</span>
</pre></div>
</div>
<figure class="align-default" id="id88">
<img alt="image-20211207160212486" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211207160212486.png" />
<figcaption>
<p><span class="caption-text">image-20211207160212486</span><a class="headerlink" href="#id88" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id89">
<img alt="1" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assets1.jpg" />
<figcaption>
<p><span class="caption-text">1</span><a class="headerlink" href="#id89" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">match_begin_time</span>   <span class="o">|</span>   <span class="n">mp_id</span>   <span class="o">|</span>   <span class="n">s_date</span>  <span class="o">|</span>    <span class="n">e_date</span>   <span class="o">|</span>    <span class="n">pt_dt</span>
</pre></div>
</div>
<figure class="align-default" id="id90">
<img alt="image-20210902142545915" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210902142545915.png" />
<figcaption>
<p><span class="caption-text">image-20210902142545915</span><a class="headerlink" href="#id90" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id91">
<img alt="image-20210902142847656" src="C:UsersluoxbAppDataRoamingTyporatypora-user-imagesimage-20210902142847656.png" />
<figcaption>
<p><span class="caption-text">image-20210902142847656</span><a class="headerlink" href="#id91" title="永久链接至图片"></a></p>
</figcaption>
</figure>
</section>
<section id="dwd-dwd-usr-login-d-nickname">
<h2>dwd.dwd_usr_login_d ( nickname)<a class="headerlink" href="#dwd-dwd-usr-login-d-nickname" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">dwd</span><span class="p">.</span><span class="n">dwd_usr_login_d</span>
<span class="k">where</span> <span class="n">uid</span> <span class="o">=</span> <span class="mi">929731696</span>
<span class="k">and</span> <span class="n">pt_dt</span> <span class="o">&gt;=</span> <span class="s1">&#39;2021-07-01&#39;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">pt_dt</span> <span class="k">desc</span>
</pre></div>
</div>
<figure class="align-default" id="id92">
<img alt="image-20211201154821467" src="C:UsersluoxbDownloads学习资料笔记markdowncode.assetsimage-20211201154821467.png" />
<figcaption>
<p><span class="caption-text">image-20211201154821467</span><a class="headerlink" href="#id92" title="永久链接至图片"></a></p>
</figcaption>
</figure>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>name    type    comment
    name    type    comment
1   dwaais2govv string  登录时间
2   uid int 用户ID
3   sznickname  string  昵称
4   dwcoin  int 元宝数量
5   dwbonus int 奖券数量
6   dwgold  int 金币数量
7   dwcert  int 代金券
8   dwscore int 总积分
9   dwmasterscore   int 总大师分
10  dwsafegold  int 保险箱货币
11  dwluckcard  int 幸运卡数量
12  dwpfsct int 用户平台分类
13  ullmac  string
14  dwlocalip   bigint  内网IP
15  dwinternetip    bigint  外网IP
16  dwterminertype  int 终端类型
17  dwuitype    int UI类型
18  dwostype    int 操作系统类型
19  sztcompany  string  终端所属公司
20  sztunittype string  终端型号
21  sztcode1    string  设备号
22  sztcode2    string  设备号
23  sztcode3    string  设备号
24  sztcode4    string  设备号
25  dwplatid    int 平台ID
26  dwsiteid    int 媒体ID(Agent)
27  dwacctype   int 帐号类型
28  dwlogintime string  登录时间
29  dwareaid    int 用户区域
30  dwproductid int 产品ID或者叫游戏ID
31  dwparam3    string  字段含义未知
32  dwcmtsid    string  组委会方案ID
33  logon_time  string  dwaais2govv转换日期
34  outnet_prov string  外网省份
35  outnet_city string  外网地市
36  outnet_isp  string  外网运营商
37  nickname_type   int 昵称类型
38  internetip  string  转dwinternetip
39  pt_dt   string
</pre></div>
</div>
<section id="id45">
<h3>标签表<a class="headerlink" href="#id45" title="永久链接至标题"></a></h3>
</section>
</section>
<section id="tags-tag-log-local-tostype-b">
<h2>tags.tag_log_local_tostype_b [最常用终端]<a class="headerlink" href="#tags-tag-log-local-tostype-b" title="永久链接至标题"></a></h2>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span>SELECT DISTINCT UID
FROM tags.tag_log_local_tostype_b
WHERE TYPE = &#39;s&#39;
AND pt_dt = &#39;9999-12-31&#39;
AND log_local_tostype = 2


系统标识    字典含义
0   保留
1   Windows
2   Android
3   IOS
4   WindowsPhone
5   Android TV
6   安卓模拟器
7   苹果模拟器
-9999   异常
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># password</span>

<span class="n">LDAP</span>
<span class="n">q</span> <span class="n">she</span><span class="o">/</span><span class="n">me</span> <span class="n">LL</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="kaggle.html" class="btn btn-neutral float-left" title="kaggle" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2021, luoxb.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>